<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CVCWVUAA Admin Dashboard</title>
<link rel="stylesheet" href="/css/styles.css">
<script src="/js/mailchimp-integration.js"></script>
<style>
  body { background: #f7f9fc; }
  main { padding: 24px 0; }
  .admin-grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
  .admin-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .admin-card h3 { margin: 0 0 8px 0; color: #002855; }
  .admin-card p { margin: 0 0 12px 0; color: #5b6777; font-size: 14px; }
  .admin-button { display: inline-block; padding: 10px 16px; background: #ffd100; color: #002855; text-decoration: none; border-radius: 8px; font-weight: 600; margin: 4px 8px 4px 0; }
  .admin-button:hover { background: #e6bc00; }
  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 16px; }
  .stat-box { background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center; }
  .stat-number { font-size: 24px; font-weight: 700; color: #002855; }
  .stat-label { font-size: 12px; color: #5b6777; text-transform: uppercase; }
</style>
</head>
<body>

<header class="site">
  <div class="wrapper topbar">
    <a class="brand" href="/index.html"><img class="site-logo" src="/assets/logo.png" alt="CVCWVUAA"></a>
    <nav><strong style="color:#ffd100">ğŸ› ï¸ Admin Dashboard</strong></nav>
  </div>
</header>

<main>
  <div class="wrapper">
    <h1>CVCWVUAA Content Management</h1>
    <p style="color:#5b6777; margin-bottom:24px;">Manage all website content from this central dashboard. Remember to commit and push changes in GitHub Desktop when finished.</p>

    <!-- Quick Stats -->
    <div class="admin-card" style="margin-bottom: 24px;">
      <h3>ğŸ“Š Content Overview</h3>
      <div class="stats">
        <div class="stat-box">
          <div class="stat-number" id="stat-board">8</div>
          <div class="stat-label">Board Positions</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-events">--</div>
          <div class="stat-label">Upcoming Events</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-news">--</div>
          <div class="stat-label">News Posts</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-alumni">--</div>
          <div class="stat-label">Alumni Profiles</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-media">--</div>
          <div class="stat-label">Media Items</div>
        </div>
      </div>
    </div>

    <!-- Main Management Grid -->
    <div class="admin-grid">
      
      <!-- Content Management -->
      <div class="admin-card">
        <h3>ğŸ“ Content Management</h3>
        <p>Manage all text content, news posts, and newsletters</p>
        <a href="media-uploader.html#news" class="admin-button">ğŸ“° News Posts</a>
        <a href="media-uploader.html#newsletters" class="admin-button">ğŸ“§ Newsletters</a>
        <a href="media-uploader.html#spotlight" class="admin-button">â­ Alumni Spotlight</a>
      </div>

      <!-- Events & Activities -->
      <div class="admin-card">
        <h3>ğŸ‰ Events & Activities</h3>
        <p>Schedule events, manage RSVPs, and track attendance</p>
        <a href="media-uploader.html#events" class="admin-button">ğŸ“… Events</a>
        <a href="/events/rsvp.html" class="admin-button">ğŸ“ RSVP Responses</a>
        <a href="media-uploader.html#minutes" class="admin-button">ğŸ“‹ Meeting Minutes</a>
      </div>

      <!-- People Management -->
      <div class="admin-card">
        <h3>ğŸ‘¥ People Management</h3>
        <p>Board members, alumni profiles, and contact information</p>
        <a href="media-uploader.html#board" class="admin-button">ğŸ›ï¸ Board Members</a>
        <a href="media-uploader.html#spotlight" class="admin-button">ğŸ“ Alumni Profiles</a>
        <a href="/admin/contacts.html" class="admin-button">ğŸ“ Contact Lists</a>
      </div>

      <!-- Media & Files -->
      <div class="admin-card">
        <h3>ğŸ–¼ï¸ Media & Files</h3>
        <p>Photos, videos, documents, and file management</p>
        <a href="media-uploader.html#media" class="admin-button">ğŸ“¸ Photo Gallery</a>
        <a href="media-uploader.html#files" class="admin-button">ğŸ“ File Upload</a>
        <a href="media-uploader.html#minutes" class="admin-button">ğŸ“„ Documents</a>
      </div>

      <!-- Mailchimp Integration -->
      <div class="admin-card">
        <h3>ğŸ“§ Mailchimp Integration</h3>
        <p>Manage email campaigns, subscriber lists, and newsletter distribution</p>
        <div id="mailchimp-config" style="margin-bottom: 16px;">
          <div style="display: grid; gap: 8px; margin-bottom: 12px;">
            <input type="password" id="mailchimp-api-key" placeholder="Mailchimp API Key" class="social-input">
            <input type="text" id="mailchimp-server" placeholder="Server (e.g., us1)" class="social-input">
            <input type="text" id="mailchimp-list-id" placeholder="List ID" class="social-input">
          </div>
          <button class="admin-button" onclick="configureMailchimp()">ğŸ”§ Configure Mailchimp</button>
          <button class="admin-button" onclick="testMailchimpConnection()">ğŸ”— Test Connection</button>
        </div>
        
        <div id="mailchimp-actions" style="display: none;">
          <div class="stats" id="mailchimp-stats" style="margin-bottom: 12px;">
            <div class="stat-box">
              <div class="stat-number" id="mailchimp-subscribers">--</div>
              <div class="stat-label">Subscribers</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="mailchimp-campaigns">--</div>
              <div class="stat-label">Campaigns</div>
            </div>
          </div>
          
          <button class="admin-button" onclick="syncMembersToMailchimp()">ğŸ”„ Sync Members</button>
          <button class="admin-button" onclick="createEmailCampaign()">ğŸ“§ Create Campaign</button>
          <button class="admin-button" onclick="viewMailchimpCampaigns()">ğŸ“Š View Campaigns</button>
          <button class="admin-button" onclick="generateSignupForm()">ğŸ“ Generate Signup Form</button>
        </div>
        
        <div id="mailchimp-status" class="status-area" style="margin-top: 12px; padding: 10px; border-radius: 4px; display: none;"></div>
      </div>

      <!-- Social Media Management -->
      <div class="admin-card">
        <h3>ğŸ“± Social Media Management</h3>
        <p>Manage social media accounts, sharing, and content</p>
        <div class="social-admin-grid">
          <div class="social-accounts">
            <h4>Social Media Accounts</h4>
            <div class="account-list">
              <div class="account-item">
                <span class="social-icon">ğŸ“˜</span>
                <span class="account-name">Facebook</span>
                <input type="url" id="facebook-url" placeholder="https://facebook.com/CVCWVUAA" class="social-input">
              </div>
              <div class="account-item">
                <span class="social-icon">ğŸ¦</span>
                <span class="account-name">Twitter</span>
                <input type="url" id="twitter-url" placeholder="https://twitter.com/CVCWVUAA" class="social-input">
              </div>
              <div class="account-item">
                <span class="social-icon">ğŸ“·</span>
                <span class="account-name">Instagram</span>
                <input type="url" id="instagram-url" placeholder="https://instagram.com/CVCWVUAA" class="social-input">
              </div>
              <div class="account-item">
                <span class="social-icon">ğŸ’¼</span>
                <span class="account-name">LinkedIn</span>
                <input type="url" id="linkedin-url" placeholder="https://linkedin.com/company/CVCWVUAA" class="social-input">
              </div>
              <div class="account-item">
                <span class="social-icon">ğŸ“º</span>
                <span class="account-name">YouTube</span>
                <input type="url" id="youtube-url" placeholder="https://youtube.com/@CVCWVUAA" class="social-input">
              </div>
            </div>
            <button class="admin-button" onclick="saveSocialAccounts()">ğŸ’¾ Save Social Accounts</button>
          </div>
          
          <div class="social-tools">
            <h4>Social Media Tools</h4>
            <div class="social-actions">
              <button class="admin-button" onclick="generateSocialPost()">âœ¨ Generate Post</button>
              <button class="admin-button" onclick="previewSharing()">ğŸ‘ï¸ Preview Sharing</button>
              <button class="admin-button" onclick="viewSocialStats()">ğŸ“ˆ Social Analytics</button>
            </div>
            
            <div class="quick-share">
              <h5>Quick Share Current Page</h5>
              <div class="share-buttons-admin">
                <button onclick="shareToFacebook()" class="share-admin facebook">ğŸ“˜ Facebook</button>
                <button onclick="shareToTwitter()" class="share-admin twitter">ğŸ¦ Twitter</button>
                <button onclick="shareToLinkedIn()" class="share-admin linkedin">ğŸ’¼ LinkedIn</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Newsletter Generation -->
      <div class="admin-card">
        <h3>ğŸ“§ Newsletter Generation</h3>
        <p>Create professional newsletters automatically</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin: 12px 0;">
          <div class="stat-card">
            <div class="stat-number" id="newsletter-count">-</div>
            <div class="stat-label">Newsletters</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="template-count">4</div>
            <div class="stat-label">Templates</div>
          </div>
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;">
          <button class="admin-button" onclick="generateNewsletter()">âœ¨ Generate Newsletter</button>
          <button class="admin-button" onclick="viewNewsletters()">ğŸ“„ View All</button>
          <button class="admin-button" onclick="manageTemplates()">ğŸ¨ Templates</button>
        </div>
      </div>

      <!-- RSVP Management -->
      <div class="admin-card">
        <h3>ğŸ« RSVP Management</h3>
        <p>Track and manage event RSVPs</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin: 12px 0;">
          <div class="stat-card">
            <div class="stat-number" id="total-rsvps">-</div>
            <div class="stat-label">Total RSVPs</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="attending-count">-</div>
            <div class="stat-label">Attending</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="pending-count">-</div>
            <div class="stat-label">Maybe/Pending</div>
          </div>
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;">
          <button class="admin-button" onclick="viewAllRSVPs()">ğŸ‘¥ View All RSVPs</button>
          <button class="admin-button" onclick="exportRSVPs()">ğŸ“Š Export Data</button>
          <button class="admin-button" onclick="viewRSVPByEvent()">ğŸ“… By Event</button>
        </div>
      </div>

      <!-- Website Settings -->
      <div class="admin-card">
        <h3>âš™ï¸ Website Settings</h3>
        <p>Site configuration, SEO, and technical settings</p>
        <a href="/admin/analytics.html" class="admin-button">ğŸ“Š Analytics</a>
        <a href="/admin/seo.html" class="admin-button">ğŸ” SEO Settings</a>
        <a href="/admin/backup.html" class="admin-button">ğŸ’¾ Backup</a>
      </div>

      <!-- Quick Actions -->
      <div class="admin-card">
        <h3>âš¡ Quick Actions</h3>
        <p>Common tasks and shortcuts</p>
        <a href="media-uploader.html" class="admin-button">ğŸš€ Full Admin Panel</a>
        <button class="admin-button" onclick="window.open('https://github.com/wvutim1958-web/cvawvuaa.org')">ğŸ“š GitHub Repo</button>
        <button class="admin-button" onclick="refreshStats()">ğŸ”„ Refresh Stats</button>
      </div>

    </div>

    <!-- Recent Activity -->
    <div class="admin-card" style="margin-top: 24px;">
      <h3>ğŸ“ˆ Recent Activity</h3>
      <p>Latest updates and changes to your website content</p>
      <div id="recent-activity" style="max-height: 200px; overflow-y: auto;">
        <p style="color: #5b6777; font-style: italic;">Loading recent changes...</p>
      </div>
    </div>

  </div>
</main>

<script>
// Load and display content statistics
async function refreshStats() {
  try {
    // Load various JSON files to get counts
    const responses = await Promise.allSettled([
      fetch('/content/board-members.json').then(r => r.json()),
      fetch('/events/events.json').then(r => r.json()),
      fetch('/news/posts.json').then(r => r.json()),
      fetch('/content/spotlight.json').then(r => r.json()),
      fetch('/content/gallery.json').then(r => r.json())
    ]);

    // Update stats
    if (responses[0].status === 'fulfilled') {
      document.getElementById('stat-board').textContent = responses[0].value.length;
    }
    if (responses[1].status === 'fulfilled') {
      const events = responses[1].value.filter(e => new Date(e.date) >= new Date());
      document.getElementById('stat-events').textContent = events.length;
    }
    if (responses[2].status === 'fulfilled') {
      const publishedPosts = responses[2].value.filter(p => p.published);
      document.getElementById('stat-news').textContent = publishedPosts.length;
    }
    if (responses[3].status === 'fulfilled') {
      document.getElementById('stat-alumni').textContent = responses[3].value.length;
    }
    if (responses[4].status === 'fulfilled') {
      document.getElementById('stat-media').textContent = responses[4].value.length;
    }
  } catch (error) {
    console.log('Stats loading error:', error);
  }
}

// Load recent activity (mock for now)
function loadRecentActivity() {
  const activity = [
    { date: '2025-09-29', action: 'Navigation standardized across all pages', type: 'system' },
    { date: '2025-09-29', action: 'Added Google Analytics tracking', type: 'analytics' },
    { date: '2025-09-29', action: 'Enhanced contact form with tracking', type: 'forms' },
    { date: '2025-09-29', action: 'Added SEO meta descriptions', type: 'seo' },
    { date: '2025-09-15', action: 'September newsletter published', type: 'content' }
  ];

  const container = document.getElementById('recent-activity');
  container.innerHTML = activity.map(item => 
    `<div style="padding: 8px 0; border-bottom: 1px solid #eee;">
      <strong>${item.action}</strong>
      <br><small style="color: #5b6777;">${item.date} â€¢ ${item.type}</small>
    </div>`
  ).join('');
}

// Social Media Management Functions
function saveSocialAccounts() {
  const accounts = {
    facebook: document.getElementById('facebook-url').value,
    twitter: document.getElementById('twitter-url').value,
    instagram: document.getElementById('instagram-url').value,
    linkedin: document.getElementById('linkedin-url').value,
    youtube: document.getElementById('youtube-url').value
  };
  
  // Save to localStorage (in a real app, this would go to a database)
  localStorage.setItem('cvcwvuaa-social-accounts', JSON.stringify(accounts));
  
  // Show success message
  showAdminNotification('âœ… Social media accounts saved successfully!', 'success');
}

function loadSocialAccounts() {
  const saved = localStorage.getItem('cvcwvuaa-social-accounts');
  if (saved) {
    const accounts = JSON.parse(saved);
    document.getElementById('facebook-url').value = accounts.facebook || '';
    document.getElementById('twitter-url').value = accounts.twitter || '';
    document.getElementById('instagram-url').value = accounts.instagram || '';
    document.getElementById('linkedin-url').value = accounts.linkedin || '';
    document.getElementById('youtube-url').value = accounts.youtube || '';
  }
}

function generateSocialPost() {
  const postContent = prompt('Enter content for social media post:');
  if (postContent) {
    const postData = {
      content: postContent,
      timestamp: new Date().toISOString(),
      platforms: ['facebook', 'twitter', 'instagram']
    };
    
    // In a real app, this would integrate with social media APIs
    console.log('Generated post:', postData);
    showAdminNotification('ğŸ“ Social media post template created!', 'info');
  }
}

function previewSharing() {
  const currentUrl = window.location.href.replace('/admin/', '/');
  const title = 'CVCWVUAA - Central Virginia Chapter of WVU Alumni Association';
  
  const preview = `
    <h4>Sharing Preview</h4>
    <p><strong>URL:</strong> ${currentUrl}</p>
    <p><strong>Title:</strong> ${title}</p>
    <p><strong>Description:</strong> Stay connected to Mountaineer Nation with the Central Virginia Chapter</p>
  `;
  
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5); z-index: 1000;
    display: flex; align-items: center; justify-content: center;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 24px; border-radius: 12px; max-width: 500px; width: 90%;">
      ${preview}
      <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">Close</button>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function viewSocialStats() {
  showAdminNotification('ğŸ“Š Social media analytics integration coming soon!', 'info');
}

function shareToFacebook() {
  const url = encodeURIComponent(window.location.href.replace('/admin/', '/'));
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
}

function shareToTwitter() {
  const url = encodeURIComponent(window.location.href.replace('/admin/', '/'));
  const text = encodeURIComponent('Check out the CVCWVUAA website!');
  window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=600,height=400');
}

function shareToLinkedIn() {
  const url = encodeURIComponent(window.location.href.replace('/admin/', '/'));
  window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank', 'width=600,height=400');
}

function showAdminNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 20px; right: 20px; z-index: 1000;
    padding: 12px 20px; border-radius: 8px; color: white;
    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    animation: slideIn 0.3s ease;
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => document.body.removeChild(notification), 300);
  }, 3000);
}

// RSVP Management Functions
function loadRSVPStats() {
  // Load RSVP manager if not already loaded
  if (typeof window.rsvpManager === 'undefined') {
    const script = document.createElement('script');
    script.src = '/js/rsvp-manager.js';
    script.onload = () => {
      setTimeout(displayRSVPStats, 100);
    };
    document.head.appendChild(script);
  } else {
    displayRSVPStats();
  }
}

function displayRSVPStats() {
  if (typeof window.rsvpManager === 'undefined') return;
  
  const stats = window.rsvpManager.getRSVPStats();
  
  document.getElementById('total-rsvps').textContent = stats.total;
  document.getElementById('attending-count').textContent = stats.attending;
  document.getElementById('pending-count').textContent = stats.maybe + stats.notAttending;
}

function viewAllRSVPs() {
  if (typeof window.rsvpManager === 'undefined') {
    showAdminNotification('RSVP system loading...', 'info');
    loadRSVPStats();
    return;
  }

  const allRSVPs = window.rsvpManager.getAllRSVPs();
  const rsvpList = Object.entries(allRSVPs).flatMap(([eventSlug, rsvps]) => 
    rsvps.map(rsvp => ({ ...rsvp, eventSlug }))
  );

  if (rsvpList.length === 0) {
    showAdminNotification('No RSVPs found', 'info');
    return;
  }

  // Create modal to display RSVPs
  const modal = createModal('All RSVPs', generateRSVPTable(rsvpList));
  document.body.appendChild(modal);
}

function viewRSVPByEvent() {
  if (typeof window.rsvpManager === 'undefined') {
    loadRSVPStats();
    return;
  }

  const events = window.rsvpManager.events || [];
  if (events.length === 0) {
    showAdminNotification('No events found', 'info');
    return;
  }

  // Create event selection modal
  const eventOptions = events.map(event => 
    `<option value="${event.slug}">${event.title} (${event.date || 'No date'})</option>`
  ).join('');

  const content = `
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Event:</label>
      <select id="event-selector" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="">-- Choose an event --</option>
        ${eventOptions}
      </select>
    </div>
    <div id="event-rsvp-display"></div>
  `;

  const modal = createModal('RSVPs by Event', content);
  document.body.appendChild(modal);

  // Add event listener for event selection
  const selector = modal.querySelector('#event-selector');
  const display = modal.querySelector('#event-rsvp-display');
  
  selector.addEventListener('change', () => {
    const eventSlug = selector.value;
    if (!eventSlug) {
      display.innerHTML = '';
      return;
    }

    const eventRSVPs = window.rsvpManager.getEventRSVPs(eventSlug);
    const stats = window.rsvpManager.getRSVPStats(eventSlug);
    
    display.innerHTML = `
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin: 16px 0;">
        <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 6px;">
          <div style="font-size: 24px; font-weight: bold; color: #28a745;">${stats.attending}</div>
          <div style="font-size: 12px; color: #5b6777;">Attending</div>
        </div>
        <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 6px;">
          <div style="font-size: 24px; font-weight: bold; color: #ffc107;">${stats.maybe}</div>
          <div style="font-size: 12px; color: #5b6777;">Maybe</div>
        </div>
        <div style="text-align: center; padding: 12px; background: #f8f9fa; border-radius: 6px;">
          <div style="font-size: 24px; font-weight: bold; color: #dc3545;">${stats.notAttending}</div>
          <div style="font-size: 12px; color: #5b6777;">Not Attending</div>
        </div>
      </div>
      ${eventRSVPs.length > 0 ? generateRSVPTable(eventRSVPs) : '<p>No RSVPs for this event yet.</p>'}
    `;
  });
}

function exportRSVPs() {
  if (typeof window.rsvpManager === 'undefined') {
    loadRSVPStats();
    return;
  }

  window.rsvpManager.exportRSVPs();
}

function generateRSVPTable(rsvps) {
  if (!rsvps || rsvps.length === 0) {
    return '<p>No RSVPs to display.</p>';
  }

  const tableRows = rsvps.map(rsvp => `
    <tr>
      <td>${rsvp.name || 'Unknown'}</td>
      <td>${rsvp.email || 'No email'}</td>
      <td style="color: ${rsvp.attending === 'yes' ? '#28a745' : rsvp.attending === 'no' ? '#dc3545' : '#ffc107'};">
        ${rsvp.attending === 'yes' ? 'âœ… Yes' : rsvp.attending === 'no' ? 'âŒ No' : 'â“ Maybe'}
      </td>
      <td>${rsvp.guests || 0}</td>
      <td>${rsvp.eventName || rsvp.eventSlug || 'Unknown Event'}</td>
      <td>${new Date(rsvp.timestamp).toLocaleDateString()}</td>
    </tr>
  `).join('');

  return `
    <div style="overflow-x: auto; margin-top: 16px;">
      <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
        <thead>
          <tr style="background-color: #f8f9fa;">
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Name</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Email</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Attending</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Guests</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Event</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Date</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
        </tbody>
      </table>
    </div>
  `;
}

function createModal(title, content) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5); z-index: 1000;
    display: flex; align-items: center; justify-content: center;
    padding: 20px; box-sizing: border-box;
  `;

  modal.innerHTML = `
    <div style="
      background: white; border-radius: 12px; max-width: 800px; width: 100%;
      max-height: 80vh; overflow-y: auto; padding: 24px; box-sizing: border-box;
    ">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">${title}</h3>
        <button onclick="this.closest('[style*=\"fixed\"]').remove()" style="
          background: none; border: none; font-size: 24px; cursor: pointer;
          color: #999; padding: 0; width: 32px; height: 32px; display: flex;
          align-items: center; justify-content: center;
        ">Ã—</button>
      </div>
      <div>${content}</div>
    </div>
  `;

  // Close modal when clicking outside
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
    }
  });

  return modal;
}

// Newsletter Management Functions
function loadNewsletterStats() {
  if (typeof window.newsletterGenerator === 'undefined') {
    const script = document.createElement('script');
    script.src = '/js/newsletter-generator.js';
    script.onload = () => {
      setTimeout(displayNewsletterStats, 100);
    };
    document.head.appendChild(script);
  } else {
    displayNewsletterStats();
  }
}

function displayNewsletterStats() {
  if (typeof window.newsletterGenerator === 'undefined') return;
  
  const newsletters = window.newsletterGenerator.getNewsletters();
  document.getElementById('newsletter-count').textContent = newsletters.length;
}

function generateNewsletter() {
  if (typeof window.newsletterGenerator === 'undefined') {
    showAdminNotification('Newsletter system loading...', 'info');
    loadNewsletterStats();
    return;
  }

  const content = `
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: 600;">Newsletter Template:</label>
      <select id="newsletter-template" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 16px;">
        <option value="monthly">ğŸ“… Monthly Newsletter</option>
        <option value="events">ğŸ‰ Event Announcement</option>
        <option value="news">ğŸ“° News Update</option>
        <option value="quarterly">ğŸ“Š Quarterly Report</option>
      </select>
      
      <label style="display: block; margin-bottom: 8px; font-weight: 600;">Newsletter Title:</label>
      <input type="text" id="newsletter-title" placeholder="Auto-generated title" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 16px;">
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">Max Events:</label>
          <input type="number" id="max-events" value="5" min="1" max="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">Max News:</label>
          <input type="number" id="max-news" value="3" min="1" max="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
      
      <div style="margin-top: 16px;">
        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <input type="checkbox" id="include-images" checked>
          <span>Include images (when available)</span>
        </label>
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="include-social" checked>
          <span>Include social media links</span>
        </label>
      </div>
    </div>
    
    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
      <button onclick="this.closest('[style*=\"fixed\"]').remove()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
      <button onclick="createNewsletterNow()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">âœ¨ Generate Newsletter</button>
    </div>
  `;

  const modal = createModal('Generate Newsletter', content);
  document.body.appendChild(modal);
}

function createNewsletterNow() {
  const templateType = document.getElementById('newsletter-template').value;
  const title = document.getElementById('newsletter-title').value;
  const maxEvents = parseInt(document.getElementById('max-events').value);
  const maxNews = parseInt(document.getElementById('max-news').value);
  const includeImages = document.getElementById('include-images').checked;
  const includeSocialLinks = document.getElementById('include-social').checked;

  try {
    const newsletter = window.newsletterGenerator.generateNewsletter(templateType, {
      title: title || undefined,
      maxEventCount: maxEvents,
      maxNewsCount: maxNews,
      includeImages,
      includeSocialLinks
    });

    const newsletterId = window.newsletterGenerator.saveNewsletter(newsletter);
    
    // Close modal
    document.querySelector('[style*="fixed"]').remove();
    
    // Show success and preview
    showAdminNotification('âœ… Newsletter generated successfully!', 'success');
    previewNewsletter(newsletter);
    
    // Update stats
    displayNewsletterStats();

  } catch (error) {
    console.error('Newsletter generation error:', error);
    showAdminNotification('âŒ Newsletter generation failed. Please try again.', 'error');
  }
}

function previewNewsletter(newsletter) {
  const content = `
    <div style="margin-bottom: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <div>
          <h4 style="margin: 0;">${newsletter.title}</h4>
          <p style="margin: 4px 0 0 0; color: #666; font-size: 14px;">
            Generated: ${new Date(newsletter.date).toLocaleDateString()} | 
            Template: ${newsletter.type} | 
            ID: ${newsletter.id.slice(-8)}
          </p>
        </div>
      </div>
      
      <div style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
        <button onclick="downloadNewsletterHTML('${newsletter.id}')" style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ’¾ Download HTML</button>
        <button onclick="copyNewsletterEmail('${newsletter.id}')" style="padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ“§ Copy Email HTML</button>
        <button onclick="deleteNewsletterConfirm('${newsletter.id}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸ Delete</button>
      </div>
    </div>
    
    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
      <iframe srcdoc="${newsletter.htmlContent.replace(/"/g, '&quot;')}" style="width: 100%; height: 500px; border: none;"></iframe>
    </div>
  `;

  const modal = createModal('Newsletter Preview', content);
  document.body.appendChild(modal);
}

function viewNewsletters() {
  if (typeof window.newsletterGenerator === 'undefined') {
    loadNewsletterStats();
    return;
  }

  const newsletters = window.newsletterGenerator.getNewsletters();
  
  if (newsletters.length === 0) {
    showAdminNotification('No newsletters found. Generate your first newsletter!', 'info');
    return;
  }

  const newslettersList = newsletters.map(newsletter => `
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px;">
      <div>
        <h5 style="margin: 0 0 4px 0;">${newsletter.title}</h5>
        <p style="margin: 0; font-size: 14px; color: #666;">
          ${new Date(newsletter.date).toLocaleDateString()} | ${newsletter.type} | ${newsletter.id.slice(-8)}
        </p>
      </div>
      <div style="display: flex; gap: 4px;">
        <button onclick="previewExistingNewsletter('${newsletter.id}')" style="padding: 4px 8px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">ğŸ‘ï¸ Preview</button>
        <button onclick="downloadNewsletterHTML('${newsletter.id}')" style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">ğŸ’¾ Download</button>
        <button onclick="deleteNewsletterConfirm('${newsletter.id}')" style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">ğŸ—‘ï¸</button>
      </div>
    </div>
  `).join('');

  const content = `
    <div style="margin-bottom: 16px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h4 style="margin: 0;">All Newsletters (${newsletters.length})</h4>
        <button onclick="generateNewsletter()" style="padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">âœ¨ Generate New</button>
      </div>
    </div>
    <div style="max-height: 400px; overflow-y: auto;">
      ${newslettersList}
    </div>
  `;

  const modal = createModal('Newsletter Manager', content);
  document.body.appendChild(modal);
}

function previewExistingNewsletter(newsletterId) {
  const newsletter = window.newsletterGenerator.getNewsletters().find(n => n.id === newsletterId);
  if (newsletter) {
    // Close current modal first
    document.querySelector('[style*="fixed"]').remove();
    // Show preview
    previewNewsletter(newsletter);
  }
}

function downloadNewsletterHTML(newsletterId) {
  const newsletter = window.newsletterGenerator.getNewsletters().find(n => n.id === newsletterId);
  if (newsletter) {
    window.newsletterGenerator.exportNewsletterHTML(newsletter);
  }
}

function copyNewsletterEmail(newsletterId) {
  const newsletter = window.newsletterGenerator.getNewsletters().find(n => n.id === newsletterId);
  if (newsletter) {
    window.newsletterGenerator.copyEmailHTML(newsletter);
  }
}

function deleteNewsletterConfirm(newsletterId) {
  if (confirm('Are you sure you want to delete this newsletter?')) {
    window.newsletterGenerator.deleteNewsletter(newsletterId);
    showAdminNotification('ğŸ—‘ï¸ Newsletter deleted successfully', 'success');
    displayNewsletterStats();
    
    // Refresh the view if modal is open
    const modal = document.querySelector('[style*="fixed"]');
    if (modal) {
      modal.remove();
      viewNewsletters();
    }
  }
}

function manageTemplates() {
  const templates = window.newsletterGenerator ? window.newsletterGenerator.templates : {
    monthly: { name: 'Monthly Newsletter', sections: ['greeting', 'upcoming-events', 'recent-events', 'news', 'spotlight', 'footer'] },
    events: { name: 'Event Announcement', sections: ['greeting', 'featured-event', 'upcoming-events', 'rsvp-call', 'footer'] },
    news: { name: 'News Update', sections: ['greeting', 'news', 'upcoming-events', 'footer'] },
    quarterly: { name: 'Quarterly Report', sections: ['greeting', 'quarter-summary', 'events-recap', 'financials', 'spotlight', 'upcoming', 'footer'] }
  };

  const templatesList = Object.entries(templates).map(([key, template]) => `
    <div style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px;">
      <h5 style="margin: 0 0 8px 0;">${template.name}</h5>
      <p style="margin: 0; font-size: 14px; color: #666;">
        Sections: ${template.sections.join(', ')}
      </p>
    </div>
  `).join('');

  const content = `
    <div>
      <p>Available newsletter templates:</p>
      ${templatesList}
      <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px;">
        <p style="margin: 0; font-size: 14px;"><strong>Note:</strong> Templates are automatically generated based on your content. Custom templates can be added by modifying the newsletter generator code.</p>
      </div>
    </div>
  `;

  const modal = createModal('Newsletter Templates', content);
  document.body.appendChild(modal);
}

// Mailchimp Integration Functions
function configureMailchimp() {
  const apiKey = document.getElementById('mailchimp-api-key').value;
  const server = document.getElementById('mailchimp-server').value;
  const listId = document.getElementById('mailchimp-list-id').value;
  
  if (!apiKey || !server || !listId) {
    showAdminNotification('âŒ Please fill in all Mailchimp configuration fields', 'error');
    return;
  }
  
  if (window.mailchimpIntegration) {
    window.mailchimpIntegration.setConfig(apiKey, server, listId);
    document.getElementById('mailchimp-actions').style.display = 'block';
    loadMailchimpStats();
    showAdminNotification('âœ… Mailchimp configured successfully!', 'success');
  } else {
    showAdminNotification('âŒ Mailchimp integration not loaded. Please refresh the page.', 'error');
  }
}

async function testMailchimpConnection() {
  if (!window.mailchimpIntegration) {
    showAdminNotification('âŒ Mailchimp integration not loaded', 'error');
    return;
  }
  
  try {
    await window.mailchimpIntegration.testConnection();
    document.getElementById('mailchimp-actions').style.display = 'block';
    loadMailchimpStats();
  } catch (error) {
    showAdminNotification('âŒ Connection test failed: ' + error.message, 'error');
  }
}

async function loadMailchimpStats() {
  if (!window.mailchimpIntegration) return;
  
  try {
    const stats = await window.mailchimpIntegration.getListStats();
    if (stats) {
      document.getElementById('mailchimp-subscribers').textContent = stats.totalMembers;
    }
    
    const campaigns = await window.mailchimpIntegration.getCampaigns(5);
    document.getElementById('mailchimp-campaigns').textContent = campaigns.length;
  } catch (error) {
    console.error('Failed to load Mailchimp stats:', error);
  }
}

async function syncMembersToMailchimp() {
  if (!window.mailchimpIntegration) {
    showAdminNotification('âŒ Mailchimp integration not configured', 'error');
    return;
  }
  
  try {
    showAdminNotification('ğŸ”„ Syncing members to Mailchimp...', 'info');
    const result = await window.mailchimpIntegration.syncMemberData();
    showAdminNotification(`âœ… Sync completed: ${result.successCount} successful, ${result.errorCount} errors`, 
      result.errorCount === 0 ? 'success' : 'warning');
    loadMailchimpStats();
  } catch (error) {
    showAdminNotification('âŒ Sync failed: ' + error.message, 'error');
  }
}

function createEmailCampaign() {
  const campaignHtml = `
    <div>
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Campaign Subject:</label>
        <input type="text" id="campaign-subject" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="e.g., CVCWVUAA Monthly Newsletter">
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Content Type:</label>
        <select id="campaign-content-type" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
          <option value="newsletter">Newsletter (Use existing)</option>
          <option value="announcement">Event Announcement</option>
          <option value="bills">Membership Bills/Dues</option>
          <option value="custom">Custom Content</option>
        </select>
      </div>
      
      <div id="newsletter-selection" style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Select Newsletter:</label>
        <select id="newsletter-select" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
          <option value="">Loading newsletters...</option>
        </select>
      </div>
      
      <div id="custom-content" style="margin-bottom: 16px; display: none;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Custom HTML Content:</label>
        <textarea id="campaign-html" style="width: 100%; height: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="Enter HTML content..."></textarea>
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 8px;">
          <input type="checkbox" id="campaign-auto-send" style="margin-right: 8px;">
          Send immediately after creation
        </label>
      </div>
      
      <div style="display: flex; gap: 8px; justify-content: flex-end;">
        <button onclick="closeModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        <button onclick="executeCampaignCreation()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Create Campaign</button>
      </div>
    </div>
  `;
  
  const modal = createModal('Create Email Campaign', campaignHtml);
  document.body.appendChild(modal);
  
  // Load newsletters for selection
  if (window.newsletterGenerator) {
    const newsletters = window.newsletterGenerator.getNewsletters();
    const select = document.getElementById('newsletter-select');
    select.innerHTML = newsletters.map(n => `<option value="${n.id}">${n.subject}</option>`).join('');
  }
  
  // Handle content type changes
  document.getElementById('campaign-content-type').addEventListener('change', (e) => {
    const customContent = document.getElementById('custom-content');
    const newsletterSelection = document.getElementById('newsletter-selection');
    
    if (e.target.value === 'custom') {
      customContent.style.display = 'block';
      newsletterSelection.style.display = 'none';
    } else {
      customContent.style.display = 'none';
      newsletterSelection.style.display = 'block';
    }
  });
}

async function executeCampaignCreation() {
  const subject = document.getElementById('campaign-subject').value;
  const contentType = document.getElementById('campaign-content-type').value;
  const autoSend = document.getElementById('campaign-auto-send').checked;
  
  if (!subject) {
    showAdminNotification('âŒ Please enter a campaign subject', 'error');
    return;
  }
  
  let htmlContent = '';
  
  try {
    if (contentType === 'newsletter') {
      const newsletterId = document.getElementById('newsletter-select').value;
      if (!newsletterId) {
        showAdminNotification('âŒ Please select a newsletter', 'error');
        return;
      }
      const newsletter = window.newsletterGenerator.getNewsletters().find(n => n.id === newsletterId);
      htmlContent = newsletter ? newsletter.html : '';
    } else if (contentType === 'custom') {
      htmlContent = document.getElementById('campaign-html').value;
    } else if (contentType === 'bills') {
      htmlContent = generateBillsEmail();
    } else if (contentType === 'announcement') {
      htmlContent = generateAnnouncementEmail();
    }
    
    if (!htmlContent) {
      showAdminNotification('âŒ No content to send', 'error');
      return;
    }
    
    closeModal();
    showAdminNotification('ğŸ“§ Creating Mailchimp campaign...', 'info');
    
    const campaign = await window.mailchimpIntegration.createCampaign(subject, htmlContent, {
      title: subject,
      fromName: 'CVCWVUAA',
      replyTo: 'president@cvawvuaa.org'
    });
    
    if (autoSend) {
      await window.mailchimpIntegration.sendCampaign(campaign.id);
      showAdminNotification('âœ… Campaign created and sent successfully!', 'success');
    } else {
      showAdminNotification('âœ… Campaign created successfully! You can send it from Mailchimp dashboard.', 'success');
    }
    
    loadMailchimpStats();
  } catch (error) {
    showAdminNotification('âŒ Failed to create campaign: ' + error.message, 'error');
  }
}

function generateBillsEmail() {
  return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>CVCWVUAA Annual Dues Notice</title>
    </head>
    <body style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <img src="https://cvawvuaa.org/assets/logo.png" alt="CVCWVUAA" style="max-width: 200px;">
        </div>
        
        <h1 style="color: #003366;">Annual Membership Dues Notice</h1>
        
        <p>Dear CVCWVUAA Member,</p>
        
        <p>This is a friendly reminder that your annual membership dues of <strong>$25.00</strong> are now due for the current year.</p>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #003366;">Payment Options:</h3>
            <ul>
                <li><strong>Online:</strong> Visit <a href="https://cvawvuaa.org/pay.html">cvawvuaa.org/pay.html</a></li>
                <li><strong>PayPal:</strong> Send to treasurer@cvawvuaa.org</li>
                <li><strong>Check:</strong> Mail to CVCWVUAA Treasurer, [Address]</li>
            </ul>
        </div>
        
        <p>Your membership helps support:</p>
        <ul>
            <li>Scholarship programs for deserving students</li>
            <li>Alumni events and networking opportunities</li>
            <li>Community service initiatives</li>
            <li>Communication and website maintenance</li>
        </ul>
        
        <p>Thank you for your continued support of CVCWVUAA!</p>
        
        <p>Sincerely,<br>
        CVCWVUAA Board of Directors</p>
        
        <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;">
        <p style="font-size: 12px; color: #666;">
            Questions? Contact us at <a href="mailto:treasurer@cvawvuaa.org">treasurer@cvawvuaa.org</a>
        </p>
    </body>
    </html>
  `;
}

function generateAnnouncementEmail() {
  return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>CVCWVUAA Event Announcement</title>
    </head>
    <body style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <img src="https://cvawvuaa.org/assets/logo.png" alt="CVCWVUAA" style="max-width: 200px;">
        </div>
        
        <h1 style="color: #003366;">Special Announcement</h1>
        
        <p>Dear CVCWVUAA Members and Friends,</p>
        
        <div style="background: #003366; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
            <h2 style="margin: 0;">Don't Miss Our Upcoming Event!</h2>
            <p style="margin: 10px 0 0 0; font-size: 18px;">[Event Details Here]</p>
        </div>
        
        <p>[Add your event description and details here...]</p>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin-top: 0;">Event Details:</h3>
            <ul>
                <li><strong>Date:</strong> [Date]</li>
                <li><strong>Time:</strong> [Time]</li>
                <li><strong>Location:</strong> [Location]</li>
                <li><strong>Cost:</strong> [Cost/Free]</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="https://cvawvuaa.org/events.html" style="display: inline-block; background: #ffd100; color: #003366; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">RSVP NOW</a>
        </div>
        
        <p>We look forward to seeing you there!</p>
        
        <p>Best regards,<br>
        CVCWVUAA Event Committee</p>
        
        <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;">
        <p style="font-size: 12px; color: #666;">
            Visit us at <a href="https://cvawvuaa.org">cvawvuaa.org</a> | Follow us on social media
        </p>
    </body>
    </html>
  `;
}

async function viewMailchimpCampaigns() {
  if (!window.mailchimpIntegration) {
    showAdminNotification('âŒ Mailchimp integration not configured', 'error');
    return;
  }
  
  try {
    const campaigns = await window.mailchimpIntegration.getCampaigns(10);
    
    const campaignsList = campaigns.map(campaign => `
      <div style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h5 style="margin: 0 0 4px 0;">${campaign.settings.subject_line || 'No Subject'}</h5>
            <p style="margin: 0; font-size: 14px; color: #666;">
              Status: ${campaign.status} | Sent: ${campaign.send_time ? new Date(campaign.send_time).toLocaleDateString() : 'Not sent'}
            </p>
            <p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">
              Recipients: ${campaign.recipients?.recipient_count || 0} | 
              Opens: ${campaign.report_summary?.opens || 0} | 
              Clicks: ${campaign.report_summary?.clicks || 0}
            </p>
          </div>
          <div>
            ${campaign.status === 'save' ? 
              `<button onclick="sendMailchimpCampaign('${campaign.id}')" style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Send</button>` :
              `<span style="color: #28a745; font-size: 12px;">âœ“ Sent</span>`
            }
          </div>
        </div>
      </div>
    `).join('');
    
    const content = `
      <div>
        <div style="margin-bottom: 16px;">
          <h4>Recent Campaigns (${campaigns.length})</h4>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
          ${campaignsList || '<p>No campaigns found.</p>'}
        </div>
      </div>
    `;
    
    const modal = createModal('Mailchimp Campaigns', content);
    document.body.appendChild(modal);
  } catch (error) {
    showAdminNotification('âŒ Failed to load campaigns: ' + error.message, 'error');
  }
}

async function sendMailchimpCampaign(campaignId) {
  try {
    await window.mailchimpIntegration.sendCampaign(campaignId);
    closeModal();
    showAdminNotification('âœ… Campaign sent successfully!', 'success');
  } catch (error) {
    showAdminNotification('âŒ Failed to send campaign: ' + error.message, 'error');
  }
}

function generateSignupForm() {
  const formHtml = `
    <div>
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Form Title:</label>
        <input type="text" id="signup-title" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="Subscribe to Our Newsletter" value="Subscribe to Our Newsletter">
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; font-weight: bold;">Description:</label>
        <input type="text" id="signup-description" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="Stay updated with CVCWVUAA news and events!" value="Stay updated with CVCWVUAA news and events!">
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Additional Fields:</label>
        <label style="display: block; margin-bottom: 4px;">
          <input type="checkbox" id="include-phone" style="margin-right: 8px;">
          Include Phone Number
        </label>
        <label style="display: block; margin-bottom: 4px;">
          <input type="checkbox" id="include-gradyear" style="margin-right: 8px;">
          Include Graduation Year
        </label>
      </div>
      
      <div style="margin-bottom: 16px;">
        <button onclick="previewSignupForm()" style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px;">ğŸ‘ï¸ Preview</button>
        <button onclick="generateSignupHTML()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ“‹ Generate HTML</button>
      </div>
      
      <div id="signup-preview" style="border: 1px solid #ddd; border-radius: 4px; padding: 16px; display: none;">
        <h4>Preview:</h4>
        <div id="signup-preview-content"></div>
      </div>
    </div>
  `;
  
  const modal = createModal('Generate Signup Form', formHtml);
  document.body.appendChild(modal);
}

function previewSignupForm() {
  const title = document.getElementById('signup-title').value;
  const description = document.getElementById('signup-description').value;
  const includePhone = document.getElementById('include-phone').checked;
  const includeGradYear = document.getElementById('include-gradyear').checked;
  
  if (window.mailchimpIntegration) {
    const formHtml = window.mailchimpIntegration.generateSignupForm({
      title,
      description,
      includePhone,
      includeGradYear
    });
    
    document.getElementById('signup-preview-content').innerHTML = formHtml;
    document.getElementById('signup-preview').style.display = 'block';
  }
}

function generateSignupHTML() {
  const title = document.getElementById('signup-title').value;
  const description = document.getElementById('signup-description').value;
  const includePhone = document.getElementById('include-phone').checked;
  const includeGradYear = document.getElementById('include-gradyear').checked;
  
  if (window.mailchimpIntegration) {
    const formHtml = window.mailchimpIntegration.generateSignupForm({
      title,
      description,
      includePhone,
      includeGradYear
    });
    
    // Copy to clipboard
    navigator.clipboard.writeText(formHtml).then(() => {
      showAdminNotification('ğŸ“‹ Signup form HTML copied to clipboard!', 'success');
    }).catch(() => {
      // Fallback - show in modal
      const htmlModal = createModal('Signup Form HTML', `
        <div>
          <p>Copy this HTML code to add the signup form to any page:</p>
          <textarea readonly style="width: 100%; height: 300px; font-family: monospace; font-size: 12px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">${formHtml}</textarea>
        </div>
      `);
      document.body.appendChild(htmlModal);
    });
  }
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', () => {
  refreshStats();
  loadRecentActivity();
  loadSocialAccounts();
  loadRSVPStats();
  loadNewsletterStats();
  
  // Load Mailchimp integration if configured
  if (localStorage.getItem('mailchimp_api_key')) {
    document.getElementById('mailchimp-api-key').value = localStorage.getItem('mailchimp_api_key');
    document.getElementById('mailchimp-server').value = localStorage.getItem('mailchimp_server');
    document.getElementById('mailchimp-list-id').value = localStorage.getItem('mailchimp_list_id');
    
    if (window.mailchimpIntegration) {
      document.getElementById('mailchimp-actions').style.display = 'block';
      loadMailchimpStats();
    }
  }
});
</script>

</body>
</html>