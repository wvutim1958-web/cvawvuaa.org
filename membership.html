<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Join or renew your CVCWVUAA membership. Annual dues: $25 per member, $15 per family member. Support the Central Virginia Chapter of the WVU Alumni Association.">
  <meta name="theme-color" content="#0b2545">
  <title>CVCWVUAA • Join / Renew</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/assets/favicon.png">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://cdn.fonts.net">
  <link rel="preconnect" href="https://www.gstatic.com">
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G14Q10H6Y2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-G14Q10H6Y2');
  </script>
  
  <!-- WVU Official Fonts -->
  <link href="https://cdn.fonts.net/kit/e691d6b8-16c1-4a77-83c8-72cc198cb2dd/e691d6b8-16c1-4a77-83c8-72cc198cb2dd.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/styles.min.css">
  <link rel="stylesheet" href="/css/wvu-components.min.css">
  <link rel="stylesheet" href="/css/wvu-cta.min.css">
  <link rel="stylesheet" href="/css/wvu-breadcrumbs.min.css">
</head>
<body>
  <a href="#main-content" class="skip-to-main">Skip to main content</a>
  
  <!-- WVU Components -->
  <div id="wvu-masthead"></div>
  <div id="wvu-navigation"></div>
  
  <!-- Breadcrumb Navigation -->
  <div id="wvu-breadcrumbs"></div>

<main id="main-content"><div class="wrapper">
  <img class="natural" src="/assets/photos/550539255_10163868473745295_3650245405852649566_n.jpg" loading="lazy" alt="Membership Banner" width="1200" height="675">
  <h1>Membership 2025–2026</h1>
  <p class="small">Annual dues: <strong>$25 per member</strong> and <strong>$15 per family member</strong>. After submitting, an invoice will be generated and you can pay online immediately.</p>

  <form id="membership-form" class="stack">
    <fieldset class="card" style="border:none">
      <legend><strong>Type of Membership</strong></legend>
      <div class="row">
        <label><input type="radio" name="Membership Type" value="Member $25" required aria-required="true"> Member — $25 / year</label>
        <label><input type="radio" name="Membership Type" value="Family Member $15"> Family Member — $15 / year</label>
      </div>
      <label for="additional-donation">Additional Donation $<input id="additional-donation" type="number" name="Additional Donation" step="1" min="0" aria-label="Additional donation amount in dollars"></label>
    </fieldset>

    <fieldset class="card" style="border:none">
      <legend><strong>Contact</strong></legend>
      <div class="row">
        <label for="first-name">First Name<input id="first-name" name="First Name" required aria-required="true"></label>
        <label for="last-name">Last Name<input id="last-name" name="Last Name" required aria-required="true"></label>
      </div>
      <div class="row">
        <label for="email">Email<input id="email" type="email" name="Email" required aria-required="true"></label>
        <label for="phone">Phone<input id="phone" type="tel" name="Phone" aria-label="Phone number"></label>
      </div>
      <label for="address">Address<textarea id="address" name="Address" rows="2" aria-label="Mailing address"></textarea></label>
    </fieldset>

    <fieldset class="card" style="border:none">
      <legend><strong>Interested in Volunteering?</strong></legend>
      <div class="row">
        <label><input type="checkbox" name="Volunteer" value="Game Watch"> Game Watch (Set‑up/Help)</label>
        <label><input type="checkbox" name="Volunteer" value="Fund Raising"> Fund Raising</label>
        <label><input type="checkbox" name="Volunteer" value="Networking"> Networking Events</label>
        <label><input type="checkbox" name="Volunteer" value="Social Events"> Social Events</label>
        <label><input type="checkbox" name="Volunteer" value="Membership"> Membership</label>
        <label for="volunteer-other">Other <input id="volunteer-other" name="Other" aria-label="Other volunteer interests"></label>
      </div>
    </fieldset>

    <fieldset class="card" style="border:none">
      <legend><strong>Family Membership</strong> (list additional names)</legend>
      <textarea id="family-members" name="Family Members" rows="3" aria-label="Family member names"></textarea>
    </fieldset>

    <div class="row">
      <button class="wvu-cta wvu-cta--primary" type="submit">Submit Membership</button>
      <a class="wvu-cta wvu-cta--secondary" href="/pay.html">Pay Dues / Donate</a>
    </div>
  </form>

  <div class="card" style="margin-top:14px">
    <p class="small"><strong>Pay by Mail:</strong> Make checks payable to <strong>CVCWVUAA</strong> and mail to 4701 Stoney Creek Parkway, Chester, VA 23831.</p>
  </div>
</div></main>

<!-- Invoice Modal -->
<div id="invoice-modal" role="dialog" aria-modal="true" aria-labelledby="invoice-modal-title" aria-hidden="true" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; align-items:center; justify-content:center;">
  <div role="document" style="background:#fff; border-radius:12px; max-width:600px; width:90%; max-height:90vh; overflow-y:auto; padding:24px; box-shadow:0 4px 20px rgba(0,0,0,0.3);">
    <h2 id="invoice-modal-title" style="margin:0 0 16px 0; color:#0b2545;">Invoice Created!</h2>
    <div id="invoice-content"></div>
    <div style="margin-top:20px; display:flex; gap:12px; justify-content:flex-end; flex-wrap:wrap;">
      <button onclick="closeInvoiceModal()" class="wvu-cta wvu-cta--secondary" aria-label="Close invoice modal">Close</button>
      <button onclick="viewFullInvoice(window.currentInvoiceData?.invoiceNumber)" class="wvu-cta wvu-cta--secondary" aria-label="View full invoice">View/Print Invoice</button>
      <a id="pay-now-btn" href="/pay.html" class="wvu-cta wvu-cta--primary">Pay Now</a>
    </div>
  </div>
</div>

  <!-- Footer Component -->
  <div id="wvu-footer"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="/js/firebase-config.js"></script>

<script>
// Handle membership form submission
document.getElementById('membership-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const submitBtn = this.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Saving...';
  submitBtn.disabled = true;
  
  try {
    const formData = new FormData(this);
    
    // Calculate total amount
    const membershipType = formData.get('Membership Type');
    const membershipCost = membershipType.includes('$25') ? 25 : 15;
    const donation = parseFloat(formData.get('Additional Donation') || 0);
    const totalAmount = membershipCost + donation;
    
    // Generate invoice number (year + random)
    const year = new Date().getFullYear();
    const invoiceNumber = `${year}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;
    
    // Prepare volunteer interests array
    const volunteerInterests = [];
    const checkboxes = this.querySelectorAll('input[name="Volunteer"]:checked');
    checkboxes.forEach(cb => volunteerInterests.push(cb.value));
    const otherVolunteer = formData.get('Other');
    if (otherVolunteer) volunteerInterests.push('Other: ' + otherVolunteer);
    
    // Member data
    const memberData = {
      firstName: formData.get('First Name'),
      lastName: formData.get('Last Name'),
      email: formData.get('Email'),
      phone: formData.get('Phone') || '',
      address: formData.get('Address') || '',
      membershipType: membershipType,
      membershipYear: year,
      volunteerInterests: volunteerInterests,
      familyMembers: formData.get('Family Members') || '',
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      payments: [{
        invoiceNumber: invoiceNumber,
        amount: totalAmount,
        date: new Date().toISOString(),
        status: 'pending'
      }]
    };
    
    // Invoice data
    const invoiceData = {
      invoiceNumber: invoiceNumber,
      memberName: `${formData.get('First Name')} ${formData.get('Last Name')}`,
      email: formData.get('Email'),
      membershipType: membershipType,
      membershipCost: membershipCost,
      donation: donation,
      totalAmount: totalAmount,
      year: year,
      status: 'pending',
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Save to Firebase
    await db.collection('members').add(memberData);
    await db.collection('invoices').add(invoiceData);
    
    // Show invoice modal
    showInvoiceModal(invoiceData);
    
    // Reset form
    this.reset();
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
    
  } catch (error) {
    console.error('Error saving membership:', error);
    alert('Error saving membership. Please try again or contact us at president@cvawvuaa.org');
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
});

function showInvoiceModal(invoice) {
  const modal = document.getElementById('invoice-modal');
  const content = document.getElementById('invoice-content');
  
  content.innerHTML = `
    <div style="background:#f6f8fb; border:1px solid #e6e9ef; border-radius:8px; padding:16px; margin-bottom:16px;">
      <p style="margin:0 0 8px 0;"><strong>Invoice #:</strong> <a href="#" onclick="viewFullInvoice('${invoice.invoiceNumber}'); return false;" style="color:#0062A3; text-decoration:underline; cursor:pointer;">${invoice.invoiceNumber}</a></p>
      <p style="margin:0 0 8px 0;"><strong>Name:</strong> ${invoice.memberName}</p>
      <p style="margin:0 0 8px 0;"><strong>Email:</strong> ${invoice.email}</p>
      <p style="margin:0;"><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
    </div>
    <table style="width:100%; border-collapse:collapse; margin-bottom:16px;">
      <tr style="background:#f6f8fb;">
        <th style="padding:8px; text-align:left; border:1px solid #e6e9ef;">Description</th>
        <th style="padding:8px; text-align:right; border:1px solid #e6e9ef;">Amount</th>
      </tr>
      <tr>
        <td style="padding:8px; border:1px solid #e6e9ef;">${invoice.membershipType}</td>
        <td style="padding:8px; text-align:right; border:1px solid #e6e9ef;">$${invoice.membershipCost.toFixed(2)}</td>
      </tr>
      ${invoice.donation > 0 ? `
      <tr>
        <td style="padding:8px; border:1px solid #e6e9ef;">Additional Donation</td>
        <td style="padding:8px; text-align:right; border:1px solid #e6e9ef;">$${invoice.donation.toFixed(2)}</td>
      </tr>
      ` : ''}
      <tr style="background:#f6f8fb; font-weight:bold;">
        <td style="padding:8px; border:1px solid #e6e9ef;">Total</td>
        <td style="padding:8px; text-align:right; border:1px solid #e6e9ef;">$${invoice.totalAmount.toFixed(2)}</td>
      </tr>
    </table>
    <p style="color:#5b6777; font-size:14px; margin:0;">Click the invoice number to view full invoice. You can pay online now or by mail.</p>
  `;
  
  // Store invoice data temporarily for viewing
  window.currentInvoiceData = invoice;
  
  // Update Pay Now button with pre-filled data
  const payBtn = document.getElementById('pay-now-btn');
  payBtn.href = `/pay.html?invoice=${invoice.invoiceNumber}&amount=${invoice.totalAmount}&email=${encodeURIComponent(invoice.email)}&name=${encodeURIComponent(invoice.memberName)}`;
  
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
  
  // Focus on modal title for accessibility
  document.getElementById('invoice-modal-title').focus();
}

function viewFullInvoice(invoiceNumber) {
  const invoice = window.currentInvoiceData;
  if (!invoice) {
    alert('Invoice data not found. Please refresh and try again.');
    return;
  }
  
  // Create a new window with the full invoice
  const invoiceWindow = window.open('', '_blank', 'width=800,height=600');
  
  invoiceWindow.document.write(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Invoice ${invoice.invoiceNumber} - CVCWVUAA</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          max-width: 800px;
          margin: 40px auto;
          padding: 20px;
          background: #fff;
        }
        .header {
          text-align: center;
          margin-bottom: 40px;
          padding-bottom: 20px;
          border-bottom: 3px solid #EAAA00;
        }
        .header h1 {
          color: #002855;
          margin: 0 0 10px 0;
        }
        .header p {
          margin: 5px 0;
          color: #5b6777;
        }
        .invoice-details {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-bottom: 30px;
        }
        .detail-box {
          background: #f6f8fb;
          padding: 15px;
          border-radius: 8px;
        }
        .detail-box h3 {
          margin: 0 0 10px 0;
          color: #002855;
          font-size: 14px;
          text-transform: uppercase;
        }
        .detail-box p {
          margin: 5px 0;
          font-size: 14px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin: 30px 0;
        }
        th, td {
          padding: 12px;
          text-align: left;
          border: 1px solid #e6e9ef;
        }
        th {
          background: #002855;
          color: #fff;
          font-weight: bold;
        }
        td {
          background: #fff;
        }
        .total-row {
          background: #f6f8fb !important;
          font-weight: bold;
          font-size: 16px;
        }
        .footer {
          margin-top: 40px;
          padding-top: 20px;
          border-top: 2px solid #e6e9ef;
          text-align: center;
          color: #5b6777;
          font-size: 12px;
        }
        .payment-info {
          background: #fff4cc;
          padding: 15px;
          border-radius: 8px;
          margin: 20px 0;
        }
        .payment-info h3 {
          margin: 0 0 10px 0;
          color: #002855;
        }
        .print-btn {
          background: #002855;
          color: #fff;
          border: none;
          padding: 12px 24px;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
          margin: 20px auto;
          display: block;
        }
        .print-btn:hover {
          background: #0062A3;
        }
        @media print {
          .print-btn { display: none; }
          body { margin: 0; }
        }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>Central Virginia Chapter<br>West Virginia University Alumni Association</h1>
        <p>4701 Stoney Creek Parkway, Chester, VA 23831</p>
        <p>Email: president@cvawvuaa.org | Web: cvawvuaa.org</p>
      </div>
      
      <h2 style="color: #002855; margin: 0 0 20px 0;">MEMBERSHIP INVOICE</h2>
      
      <div class="invoice-details">
        <div class="detail-box">
          <h3>Invoice Information</h3>
          <p><strong>Invoice Number:</strong> ${invoice.invoiceNumber}</p>
          <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
          <p><strong>Status:</strong> Pending Payment</p>
        </div>
        <div class="detail-box">
          <h3>Member Information</h3>
          <p><strong>Name:</strong> ${invoice.memberName}</p>
          <p><strong>Email:</strong> ${invoice.email}</p>
          <p><strong>Year:</strong> ${invoice.year}</p>
        </div>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th style="text-align: right;">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>${invoice.membershipType}</td>
            <td style="text-align: right;">$${invoice.membershipCost.toFixed(2)}</td>
          </tr>
          ${invoice.donation > 0 ? `
          <tr>
            <td>Additional Donation</td>
            <td style="text-align: right;">$${invoice.donation.toFixed(2)}</td>
          </tr>
          ` : ''}
          <tr class="total-row">
            <td>TOTAL DUE</td>
            <td style="text-align: right;">$${invoice.totalAmount.toFixed(2)}</td>
          </tr>
        </tbody>
      </table>
      
      <div class="payment-info">
        <h3>Payment Options</h3>
        <p><strong>Online:</strong> Visit <a href="https://cvawvuaa.org/pay.html?invoice=${invoice.invoiceNumber}">cvawvuaa.org/pay.html</a> to pay securely with PayPal</p>
        <p><strong>By Mail:</strong> Make checks payable to <strong>CVCWVUAA</strong> and mail to:<br>
        4701 Stoney Creek Parkway, Chester, VA 23831</p>
        <p style="margin-top: 10px; font-size: 12px;"><em>Please include invoice number ${invoice.invoiceNumber} with your payment</em></p>
      </div>
      
      <div class="footer">
        <p>Thank you for your membership and support!</p>
        <p>Questions? Contact us at president@cvawvuaa.org</p>
      </div>
      
      <button class="print-btn" onclick="window.print()">Print Invoice</button>
    </body>
    </html>
  `);
  
  invoiceWindow.document.close();
}

function closeInvoiceModal() {
  const modal = document.getElementById('invoice-modal');
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden', 'true');
}
</script>

<!-- WVU Component Loaders -->
<script src="/includes/component-loader.min.js"></script>
<script src="/js/wvu-breadcrumbs.min.js"></script>

</body></html>
