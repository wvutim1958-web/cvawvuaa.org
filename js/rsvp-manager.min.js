class RSVPManager{constructor(){this.rsvps=this.loadRSVPs(),this.events=[],this.init()}async init(){await this.loadEvents(),this.setupEventListeners()}async loadEvents(){try{const e=await fetch("/events/events.json",{cache:"no-store"});e.ok&&(this.events=await e.json())}catch(e){console.warn("Could not load events:",e)}}loadRSVPs(){const e=localStorage.getItem("cvcwvuaa-rsvps");return e?JSON.parse(e):{}}saveRSVPs(){localStorage.setItem("cvcwvuaa-rsvps",JSON.stringify(this.rsvps))}submitRSVP(e,t){const n=this.generateRSVPId();this.rsvps[e]||(this.rsvps[e]=[]);const s={id:n,eventSlug:e,timestamp:(new Date).toISOString(),...t};return this.rsvps[e].push(s),this.saveRSVPs(),this.sendRSVPConfirmation(s),n}generateRSVPId(){return"rsvp_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getEventRSVPs(e){return this.rsvps[e]||[]}getAllRSVPs(){return this.rsvps}getRSVPStats(e=null){if(e){const t=this.getEventRSVPs(e);return{total:t.length,attending:t.filter(e=>"yes"===e.attending).length,notAttending:t.filter(e=>"no"===e.attending).length,maybe:t.filter(e=>"maybe"===e.attending).length}}{let e=0,t=0,n=0,s=0;return Object.values(this.rsvps).forEach(o=>{e+=o.length,t+=o.filter(e=>"yes"===e.attending).length,n+=o.filter(e=>"no"===e.attending).length,s+=o.filter(e=>"maybe"===e.attending).length}),{total:e,attending:t,notAttending:n,maybe:s}}}sendRSVPConfirmation(e){const t=this.events.find(t=>t.slug===e.eventSlug),n=t?t.title:"Event";this.showNotification(`‚úÖ RSVP confirmed for "${n}"! Confirmation ID: ${e.id.slice(-8)}`,"success")}setupEventListeners(){const e=document.getElementById("rsvp-form");e&&e.addEventListener("submit",e=>{e.preventDefault(),this.handleRSVPSubmission(e.target)}),this.autoPopulateEventFromURL()}handleRSVPSubmission(e){const t=new FormData(e),n={name:t.get("Name"),email:t.get("Email"),phone:t.get("Phone"),attending:t.get("attending"),guests:parseInt(t.get("guests"))||0,comments:t.get("comments"),memberType:t.get("member-type"),eventName:t.get("Event")},s=t.get("event-slug")||this.getEventSlugFromURL();if(s)if(n.name&&n.email&&n.attending)try{const t=this.submitRSVP(s,n);this.submitToFormSubmit(e,t),e.reset(),this.showRSVPSuccess(t)}catch(e){console.error("RSVP submission error:",e),this.showNotification("‚ùå RSVP submission failed. Please try again.","error")}else this.showNotification("‚ùå Please fill in all required fields","error");else this.showNotification("‚ùå Event not specified","error")}async submitToFormSubmit(e,t){try{const n=document.createElement("input");n.type="hidden",n.name="rsvp_id",n.value=t,e.appendChild(n);const s=await fetch(e.action,{method:"POST",body:new FormData(e)});console.log("FormSubmit response:",s.ok)}catch(e){console.warn("FormSubmit error:",e)}}autoPopulateEventFromURL(){const e=new URLSearchParams(window.location.search).get("event");if(e){const t=this.events.find(t=>t.slug===e);if(t){const n=document.getElementById("event-name");n&&(n.value=t.title);const s=document.getElementById("rsvp-form");if(s&&!s.querySelector('input[name="event-slug"]')){const t=document.createElement("input");t.type="hidden",t.name="event-slug",t.value=e,s.appendChild(t)}document.title=`RSVP - ${t.title} ‚Ä¢ CVCWVUAA`}}}getEventSlugFromURL(){return new URLSearchParams(window.location.search).get("event")}showRSVPSuccess(e){const t=`\n      <div class="rsvp-success" style="\n        background: #d4edda; border: 1px solid #c3e6cb; color: #155724;\n        padding: 20px; border-radius: 8px; margin: 20px 0;\n      ">\n        <h3 style="margin-top: 0; color: #155724;">‚úÖ RSVP Confirmed!</h3>\n        <p><strong>Confirmation ID:</strong> ${e.slice(-8)}</p>\n        <p>Thank you for your response. You should receive a confirmation email shortly.</p>\n        <p><a href="/events.html">‚Üê Back to Events</a></p>\n      </div>\n    `,n=document.getElementById("rsvp-form");n&&(n.style.display="none",n.insertAdjacentHTML("afterend",t))}exportRSVPs(e=null){const t=e?this.getEventRSVPs(e):Object.values(this.rsvps).flat();if(0===t.length)return void this.showNotification("No RSVPs to export","info");const n=[["Event","Name","Email","Phone","Attending","Guests","Member Type","Comments","Date"].join(","),...t.map(e=>[e.eventName||"Unknown Event",`"${e.name||""}"`,e.email||"",e.phone||"",e.attending||"",e.guests||0,e.memberType||"",`"${(e.comments||"").replace(/"/g,'""')}"`,new Date(e.timestamp).toLocaleDateString()].join(","))].join("\n"),s=new Blob([n],{type:"text/csv"}),o=window.URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=`rsvps_${e||"all"}_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o),this.showNotification(`üìä RSVPs exported successfully (${t.length} records)`,"success")}showNotification(e,t="info"){const n=document.createElement("div");n.style.cssText=`\n      position: fixed; top: 20px; right: 20px; z-index: 1000;\n      padding: 12px 20px; border-radius: 8px; color: white;\n      background: ${"success"===t?"#28a745":"error"===t?"#dc3545":"#007bff"};\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      max-width: 300px; animation: slideInRight 0.3s ease;\n    `,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutRight 0.3s ease",setTimeout(()=>{n.parentNode&&document.body.removeChild(n)},300)},4e3)}}const style=document.createElement("style");style.textContent="\n  @keyframes slideInRight {\n    from { transform: translateX(100%); opacity: 0; }\n    to { transform: translateX(0); opacity: 1; }\n  }\n  @keyframes slideOutRight {\n    from { transform: translateX(0); opacity: 1; }\n    to { transform: translateX(100%); opacity: 0; }\n  }\n",document.head.appendChild(style);const rsvpManager=new RSVPManager;window.rsvpManager=rsvpManager;