!function(){const e="cvcwvuaa-rsvps";function t(){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch{return[]}}function n(t){localStorage.setItem(e,JSON.stringify(t))}function r(){const e=document.getElementById("rsvp-admin");if(!e)return;const n=new URLSearchParams(location.search),r="1"===n.get("admin");if(e.style.display=r?"":"none",!r)return;const o=document.querySelector("#rsvp-table tbody");if(!o)return;o.innerHTML="";const a=document.getElementById("rsvp-table");a&&(a.style.border="1px solid var(--border-color)",a.style.borderRadius="8px");let d=t();const c=n.get("eventId");c&&(d=d.filter(e=>(e.eventId||"")===c)),d.sort((e,t)=>e.ts<t.ts?1:-1);for(const e of d){const t=document.createElement("tr");t.innerHTML=`\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)">${new Date(e.ts).toLocaleString()}</td>\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)">${e.name}</td>\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)"><a href="mailto:${e.email}">${e.email}</a></td>\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)">${e.game}</td>\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)">${e.count}</td>\n        <td style="padding:6px 8px;border-bottom:1px solid var(--border-color)">${e.requests}</td>`,o.appendChild(t)}}function o(){const e=document.getElementById("export-json"),o=document.getElementById("export-csv"),a=document.getElementById("export-emails"),d=document.getElementById("import-json"),c=document.getElementById("clear-local");e&&e.addEventListener("click",()=>{const e=new Blob([JSON.stringify(t(),null,2)],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`rsvps-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(n)}),a&&a.addEventListener("click",()=>{const e=new URLSearchParams(location.search).get("eventId");let n=t();e&&(n=n.filter(t=>(t.eventId||"")===e));const r=Array.from(new Set(n.map(e=>(e.email||"").trim()).filter(Boolean))),o=new Blob([r.join("\n")],{type:"text/plain"}),a=URL.createObjectURL(o),d=document.createElement("a");d.href=a,d.download="emails.txt",document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(a)}),o&&o.addEventListener("click",()=>{const e=t(),n=["ts","name","email","game","count","requests"],r=n.join(","),o=e.map(e=>n.map(t=>{return n=e[t],'"'+String(n??"").replaceAll('"','""')+'"';var n}).join(",")).join("\n"),a=new Blob([r+"\n"+o],{type:"text/csv"}),d=URL.createObjectURL(a),c=document.createElement("a");c.href=d,c.download="rsvps.csv",document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(d)}),d&&d.addEventListener("change",async e=>{const t=e.target.files&&e.target.files[0];if(!t)return;const o=await t.text();try{const e=JSON.parse(o);Array.isArray(e)?(n(e),r(),alert("Imported RSVPs from JSON")):alert("Invalid JSON format")}catch(e){alert("Error parsing JSON")}}),c&&c.addEventListener("click",()=>{confirm("Clear local RSVPs from this browser?")&&(n([]),r())})}document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(location.search).get("game");if(e){const t=document.getElementById("game");t&&(t.value=e)}const a=document.getElementById("rsvp-form");a&&(a.addEventListener("submit",e=>{const r=function(e){const t=Object.fromEntries(new FormData(e).entries());return{ts:(new Date).toISOString(),name:(t.Name||"").trim(),email:(t.Email||"").trim(),game:(t.Game||"").trim(),count:Number(t.Count||1),requests:(t.Requests||"").trim(),eventId:(t.eventId||"").trim()}}(a),o=new URLSearchParams(location.search).get("eventId");o&&(r.eventId=o);const d=t();d.push(r),n(d)}),o(),r())})}();