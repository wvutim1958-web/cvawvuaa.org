<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CVCWVUAA Member Directory</title>
<link rel="stylesheet" href="/css/styles.css">
<style>
  .directory-container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 2rem;
  }

  .directory-header {
    background: linear-gradient(135deg, var(--wvu-blue), #1e40af);
    color: white;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    text-align: center;
  }

  .member-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    text-align: center;
    border-top: 4px solid var(--wvu-blue);
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--wvu-blue);
    margin-bottom: 0.5rem;
  }

  .search-bar {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }

  .search-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr auto;
    gap: 1rem;
    align-items: center;
  }

  .search-input {
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 1rem;
  }

  .member-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .member-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.2s ease;
  }

  .member-card:hover {
    transform: translateY(-2px);
  }

  .member-header {
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .member-name {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--wvu-blue);
    margin-bottom: 0.5rem;
  }

  .member-details {
    padding: 1.5rem;
  }

  .member-info {
    display: grid;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .member-info-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  .member-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .member-btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .member-btn.primary {
    background: var(--wvu-blue);
    color: white;
  }

  .member-btn.secondary {
    background: #64748b;
    color: white;
  }

  .member-btn.success {
    background: #10b981;
    color: white;
  }

  .member-btn.warning {
    background: #f59e0b;
    color: white;
  }

  .member-status {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-active {
    background: #d1fae5;
    color: #065f46;
  }

  .status-expired {
    background: #fee2e2;
    color: #991b1b;
  }

  .status-pending {
    background: #fef3c7;
    color: #92400e;
  }

  .bulk-actions {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }

  .bulk-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .export-section {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
  }

  .checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
</style>
</head>
<body>

<div class="directory-container">
  
  <!-- Header -->
  <div class="directory-header">
    <h1>👥 Member Directory</h1>
    <p>Central Virginia Chapter Member Management System</p>
  </div>

  <!-- Member Statistics -->
  <div class="member-stats">
    <div class="stat-card">
      <div class="stat-number">127</div>
      <div>Total Members</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">118</div>
      <div>Active Members</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">6</div>
      <div>Renewals Due</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">3</div>
      <div>New This Month</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">89%</div>
      <div>Retention Rate</div>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="search-bar">
    <div class="search-grid">
      <input type="text" class="search-input" placeholder="🔍 Search members by name, email, or class year..." id="memberSearch" oninput="filterMembers()">
      <select class="search-input" id="statusFilter" onchange="filterMembers()">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="expired">Expired</option>
        <option value="pending">Pending</option>
      </select>
      <select class="search-input" id="typeFilter" onchange="filterMembers()">
        <option value="">All Types</option>
        <option value="individual">Individual</option>
        <option value="family">Family</option>
        <option value="student">Student</option>
        <option value="lifetime">Lifetime</option>
      </select>
      <select class="search-input" id="yearFilter" onchange="filterMembers()">
        <option value="">All Years</option>
        <option value="2020s">2020-2029</option>
        <option value="2010s">2010-2019</option>
        <option value="2000s">2000-2009</option>
        <option value="1990s">1990-1999</option>
        <option value="1980s">1980-1989</option>
        <option value="older">Before 1980</option>
      </select>
      <button class="action-btn" onclick="openAddMemberModal()">➕ Add Member</button>
      <button class="action-btn success" onclick="importCSVToDirectory()">📁 Import CSV</button>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div class="bulk-actions">
    <h3>🛠️ Bulk Actions</h3>
    <div class="bulk-actions-grid">
      <button class="action-btn success" onclick="sendBulkEmail('welcome')">📧 Welcome New Members</button>
      <button class="action-btn warning" onclick="sendBulkEmail('renewal')">⏰ Send Renewal Reminders</button>
      <button class="action-btn" onclick="sendBulkEmail('event')">🎉 Event Invitations</button>
      <button class="action-btn secondary" onclick="exportMemberList()">📊 Export Member List</button>
      <button class="action-btn" onclick="generateLabels()">🏷️ Generate Labels</button>
      <button class="action-btn" onclick="syncMailchimp()">📮 Sync with Mailchimp</button>
    </div>
  </div>

  <!-- Member Cards -->
  <div class="member-grid" id="memberGrid">
    <!-- Member cards will be populated by JavaScript -->
  </div>
          <div class="member-info-item">
            <span>💳</span> Family Membership
          </div>
          <div class="member-info-item">
            <span>📅</span> Expires: Dec 31, 2025
          </div>
          <div class="member-info-item">
            <span>📍</span> Richmond, VA
          </div>
        </div>
        <div class="member-actions">
          <button class="member-btn primary" onclick="contactMember('john.smith@email.com')">📧 Email</button>
          <button class="member-btn secondary" onclick="editMember('smith_j')">✏️ Edit</button>
          <button class="member-btn success" onclick="viewHistory('smith_j')">📋 History</button>
        </div>
      </div>
    </div>

    <div class="member-card" data-status="expired" data-type="individual" data-year="2010">
      <div class="member-header">
        <div class="member-name">Michael Johnson</div>
        <span class="member-status status-expired">Expired</span>
      </div>
      <div class="member-details">
        <div class="member-info">
          <div class="member-info-item">
            <span>📧</span> m.johnson@email.com
          </div>
          <div class="member-info-item">
            <span>📞</span> (555) 987-6543
          </div>
          <div class="member-info-item">
            <span>🎓</span> Class of 2010 (Business)
          </div>
          <div class="member-info-item">
            <span>💳</span> Individual Membership
          </div>
          <div class="member-info-item">
            <span>📅</span> Expired: Aug 31, 2025
          </div>
          <div class="member-info-item">
            <span>📍</span> Charlottesville, VA
          </div>
        </div>
        <div class="member-actions">
          <button class="member-btn warning" onclick="sendRenewalReminder('m.johnson@email.com')">⏰ Renewal</button>
          <button class="member-btn secondary" onclick="editMember('johnson_m')">✏️ Edit</button>
          <button class="member-btn success" onclick="viewHistory('johnson_m')">📋 History</button>
        </div>
      </div>
    </div>

    <div class="member-card" data-status="active" data-type="lifetime" data-year="1987">
      <div class="member-header">
        <div class="member-name">Robert & Linda Wilson</div>
        <span class="member-status status-active">Lifetime</span>
      </div>
      <div class="member-details">
        <div class="member-info">
          <div class="member-info-item">
            <span>📧</span> rwilson@email.com
          </div>
          <div class="member-info-item">
            <span>📞</span> (555) 456-7890
          </div>
          <div class="member-info-item">
            <span>🎓</span> Class of 1987 (Medicine)
          </div>
          <div class="member-info-item">
            <span>💳</span> Lifetime Membership
          </div>
          <div class="member-info-item">
            <span>📅</span> Lifetime Member
          </div>
          <div class="member-info-item">
            <span>📍</span> Virginia Beach, VA
          </div>
        </div>
        <div class="member-actions">
          <button class="member-btn primary" onclick="contactMember('rwilson@email.com')">📧 Email</button>
          <button class="member-btn secondary" onclick="editMember('wilson_r')">✏️ Edit</button>
          <button class="member-btn success" onclick="viewHistory('wilson_r')">📋 History</button>
        </div>
      </div>
    </div>

    <div class="member-card" data-status="pending" data-type="student" data-year="2024">
      <div class="member-header">
        <div class="member-name">Emily Davis</div>
        <span class="member-status status-pending">Pending</span>
      </div>
      <div class="member-details">
        <div class="member-info">
          <div class="member-info-item">
            <span>📧</span> edavis@mix.wvu.edu
          </div>
          <div class="member-info-item">
            <span>📞</span> (555) 321-0987
          </div>
          <div class="member-info-item">
            <span>🎓</span> Class of 2024 (Communications)
          </div>
          <div class="member-info-item">
            <span>💳</span> Student Membership
          </div>
          <div class="member-info-item">
            <span>📅</span> Payment Pending
          </div>
          <div class="member-info-item">
            <span>📍</span> Norfolk, VA
          </div>
        </div>
        <div class="member-actions">
          <button class="member-btn warning" onclick="sendPaymentReminder('edavis@mix.wvu.edu')">💰 Payment</button>
          <button class="member-btn secondary" onclick="editMember('davis_e')">✏️ Edit</button>
          <button class="member-btn success" onclick="approveMembership('davis_e')">✅ Approve</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Export Tools -->
  <div class="export-section">
    <h3>📊 Export & Reports</h3>
    <div class="bulk-actions-grid">
      <button class="action-btn" onclick="exportCSV()">📋 Export CSV</button>
      <button class="action-btn" onclick="exportMailingList()">📮 Mailing List</button>
      <button class="action-btn" onclick="exportPhoneList()">📞 Phone Directory</button>
      <button class="action-btn" onclick="generateMembershipReport()">📈 Membership Report</button>
      <button class="action-btn" onclick="exportByClass()">🎓 Export by Class Year</button>
      <button class="action-btn" onclick="exportRenewalList()">⏰ Renewal Report</button>
    </div>
  </div>
</div>

<!-- Add Member Modal -->
<div id="addMemberModal" class="modal">
  <div class="modal-content">
    <h3>➕ Add New Member</h3>
    
    <div class="form-group">
      <label>Full Name:</label>
      <input type="text" id="memberFullName" placeholder="John Smith or John & Jane Smith">
    </div>
    
    <div class="form-group">
      <label>Email Address:</label>
      <input type="email" id="memberEmail" placeholder="john@email.com">
    </div>
    
    <div class="form-group">
      <label>Phone Number:</label>
      <input type="tel" id="memberPhone" placeholder="(555) 123-4567">
    </div>
    
    <div class="form-group">
      <label>Class Year:</label>
      <input type="number" id="memberYear" placeholder="1995" min="1950" max="2030">
    </div>
    
    <div class="form-group">
      <label>Degree/Major:</label>
      <input type="text" id="memberMajor" placeholder="Engineering, Business, etc.">
    </div>
    
    <div class="form-group">
      <label>Membership Type:</label>
      <select id="memberType">
        <option value="individual">Individual ($25/year)</option>
        <option value="family">Family ($40/year)</option>
        <option value="student">Student ($15/year)</option>
        <option value="lifetime">Lifetime ($500)</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>Address:</label>
      <textarea id="memberAddress" placeholder="Street Address, City, State ZIP" rows="3"></textarea>
    </div>
    
    <div class="form-group">
      <label>Interests:</label>
      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="interest1"> <label for="interest1">Events</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interest2"> <label for="interest2">Networking</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interest3"> <label for="interest3">Volunteering</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="interest4"> <label for="interest4">Sports</label>
        </div>
      </div>
    </div>
    
    <div style="text-align: right; margin-top: 2rem;">
      <button class="action-btn secondary" onclick="closeAddMemberModal()">Cancel</button>
      <button class="action-btn" onclick="addNewMember()">Add Member</button>
    </div>
  </div>
</div>

<script>
// Real member data loaded from CSV - starts empty until imported
let members = [];

// Load real member data from localStorage (shared with advanced member manager)
function loadRealMembers() {
  // Try to load from the main members storage first
  const savedMembers = localStorage.getItem('cvcwvuaa-members');
  
  // Also check for directory-specific storage (for bidirectional sync)
  const directorySavedMembers = localStorage.getItem('cvcwvuaa-directory-members');
  
  // Get sync timestamp to determine which data is newer
  const lastSync = localStorage.getItem('cvcwvuaa-last-sync');
  const lastDirectoryUpdate = localStorage.getItem('cvcwvuaa-directory-last-update');
  
  let memberData = [];
  
  // Use the most recent data source
  if (savedMembers) {
    try {
      memberData = JSON.parse(savedMembers);
      console.log(`Loaded ${memberData.length} members from main storage`);
    } catch (e) {
      console.error('Error loading saved members:', e);
    }
  }
  
  // If we have directory-specific data and it's newer, use that
  if (directorySavedMembers && (!lastSync || (lastDirectoryUpdate && lastDirectoryUpdate > lastSync))) {
    try {
      const directoryData = JSON.parse(directorySavedMembers);
      if (directoryData.length > 0) {
        memberData = directoryData;
        console.log(`Using directory-specific data: ${memberData.length} members`);
      }
    } catch (e) {
      console.error('Error loading directory members:', e);
    }
  }
  
  // Convert advanced manager data to directory format - DO NOT override address fields with defaults
  members = memberData.map(member => ({
    ...member,
    classYear: member.year || member.classYear || "Unknown",
    major: member.major || "Alumni",
    // IMPORTANT: Preserve actual address data from CSV - don't override with defaults
    streetAddress: member.streetAddress || "",
    city: member.city || "",
    state: member.state || "",
    zip: member.zip || "",
    // Only use location if no individual city field exists
    displayLocation: member.city ? `${member.city}${member.state ? ', ' + member.state : ''}` : (member.location || ""),
    status: member.duesStatus || member.status || "unknown",
    // Preserve financial data
    totalAmountPaid: member.totalAmountPaid || 0,
    scholarshipAmount: member.scholarshipAmount || 0,
    duesAmount: member.duesAmount || 0,
    generalFundAmount: member.generalFundAmount || 0,
    // Preserve admin change flags
    hasAdminFinancialChanges: member.hasAdminFinancialChanges || false,
    hasAdminPaymentChanges: member.hasAdminPaymentChanges || false
  }));
  
  console.log(`Directory loaded: ${members.length} members total`);
}

// Save directory changes back to main storage
function saveDirectoryChanges() {
  // Update the main storage
  localStorage.setItem('cvcwvuaa-members', JSON.stringify(members));
  
  // Update directory timestamp
  localStorage.setItem('cvcwvuaa-directory-last-update', new Date().toISOString());
  
  console.log('Directory changes saved to main storage');
}

// Initialize the member directory
function initializeDirectory() {
  loadRealMembers(); // Load real member data first
  
  if (members.length === 0) {
    showEmptyDirectoryState();
  } else {
    updateMemberStats();
    renderMemberCards();
  }
}

// Show empty state when no real members are loaded
function showEmptyDirectoryState() {
  const grid = document.getElementById('memberGrid');
  grid.innerHTML = `
    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 12px;">
      <h3>📋 No Members Loaded</h3>
      <p>Import your CVCWVUAA membership database CSV to view all real members here.</p>
      <p>Go to <strong>Advanced Member Manager</strong> to import your CSV file.</p>
      <a href="/admin/advanced-member-manager.html" class="btn-primary" style="display: inline-block; padding: 12px 24px; text-decoration: none; margin-top: 10px;">
        📁 Go to Member Manager
      </a>
    </div>
  `;
  
  // Set stats to zero
  document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = 0;
  document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = 0;
  document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = 0;
  document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = 0;
}

// Update statistics
function updateMemberStats() {
  const totalMembers = members.length;
  const activeMembers = members.filter(m => m.duesStatus === 'current').length;
  const pendingMembers = members.filter(m => m.duesStatus === 'pending').length;
  const expiredMembers = members.filter(m => m.duesStatus === 'overdue').length;
  
  document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = totalMembers;
  document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = activeMembers;
  document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = pendingMembers;
  document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = expiredMembers;
}

// Render member cards
function renderMemberCards() {
  const grid = document.getElementById('memberGrid');
  grid.innerHTML = '';
  
  members.forEach(member => {
    const status = member.duesStatus === 'current' ? 'active' : 
                   member.duesStatus === 'pending' ? 'pending' : 'expired';
    
    const card = document.createElement('div');
    card.className = 'member-card';
    card.dataset.status = status;
    card.dataset.type = member.type;
    card.dataset.year = member.year;
    
    card.innerHTML = `
      <div class="member-header">
        <div class="member-name">${member.name}</div>
        <span class="member-status status-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
      </div>
      <div class="member-details">
        <div class="member-info">
          <div class="member-info-item">
            <span>📧</span> ${member.email}
          </div>
          <div class="member-info-item">
            <span>📞</span> ${member.phone}
          </div>
          <div class="member-info-item">
            <span>🎓</span> Class of ${member.classYear} (${member.major})
          </div>
          ${member.fullAddress ? `
          <div class="member-info-item">
            <span>🏠</span> ${member.fullAddress}
          </div>
          ` : member.streetAddress || member.city || member.state ? `
          <div class="member-info-item">
            <span>📍</span> ${[member.streetAddress, member.city, member.state, member.zip].filter(x => x).join(', ') || 'Address not available'}
          </div>
          ` : `
          <div class="member-info-item">
            <span>📍</span> ${member.displayLocation || 'Address not available'}
          </div>
          `}
          <div class="member-info-item">
            <span>💳</span> ${member.type.charAt(0).toUpperCase() + member.type.slice(1)} Member
          </div>
          ${member.lastPayment ? `
          <div class="member-info-item">
            <span>💰</span> Last Payment: ${new Date(member.lastPayment).toLocaleDateString()}
          </div>
          ` : ''}
        </div>
        <div class="member-actions">
          <button class="action-btn small" onclick="editMember(${member.id})">✏️ Edit</button>
          <button class="action-btn small" onclick="emailMember('${member.email}')">📧 Email</button>
          <button class="action-btn small warning" onclick="deleteMember(${member.id})">🗑️ Delete</button>
        </div>
      </div>
    `;
    
    grid.appendChild(card);
  });
}

// Filter members
function filterMembers() {
  const search = document.getElementById('memberSearch').value.toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  const typeFilter = document.getElementById('typeFilter').value;
  const yearFilter = document.getElementById('yearFilter').value;
  
  const cards = document.querySelectorAll('.member-card');
  
  cards.forEach(card => {
    let show = true;
    
    // Search filter
    if (search && !card.textContent.toLowerCase().includes(search)) {
      show = false;
    }
    
    // Status filter
    if (statusFilter && card.dataset.status !== statusFilter) {
      show = false;
    }
    
    // Type filter
    if (typeFilter && card.dataset.type !== typeFilter) {
      show = false;
    }
    
    // Year filter
    if (yearFilter && card.dataset.year) {
      const year = parseInt(card.dataset.year);
      const decade = Math.floor(year / 10) * 10;
      const filterDecade = yearFilter.replace('s', '');
      
      if (yearFilter === 'older' && year >= 1980) show = false;
      else if (yearFilter !== 'older' && decade !== parseInt(filterDecade)) show = false;
    }
    
    card.style.display = show ? 'block' : 'none';
  });
}

// Modal functions
function openAddMemberModal() {
  document.getElementById('addMemberModal').style.display = 'block';
}

function closeAddMemberModal() {
  document.getElementById('addMemberModal').style.display = 'none';
}

function addNewMember() {
  const name = document.getElementById('memberFullName').value;
  const email = document.getElementById('memberEmail').value;
  
  if (!name || !email) {
    alert('Please fill in required fields (Name and Email)');
    return;
  }
  
  alert(`✅ New member added successfully!\n\nName: ${name}\nEmail: ${email}\n\nWelcome email will be sent automatically.`);
  closeAddMemberModal();
  
  // Clear form
  document.querySelectorAll('#addMemberModal input, #addMemberModal select, #addMemberModal textarea').forEach(field => {
    field.value = '';
    if (field.type === 'checkbox') field.checked = false;
  });
}

// Member actions
function contactMember(email) {
  window.open(`mailto:${email}?subject=From CVCWVUAA President`);
}

function editMember(memberId) {
  alert(`✏️ Opening member editor for ${memberId}\n\nThis would open a detailed member editing form with:\n• Personal information\n• Membership history\n• Payment records\n• Event attendance\n• Communication preferences`);
}

function viewHistory(memberId) {
  alert(`📋 Member History for ${memberId}\n\n• Membership since: 2018\n• Events attended: 12\n• Last payment: Sept 2025\n• Communications sent: 24\n• Volunteer hours: 8\n\nDetailed history would show in a popup or new tab.`);
}

function sendRenewalReminder(email) {
  alert(`⏰ Sending renewal reminder to ${email}\n\nCustomized email sent with:\n• Current membership status\n• Renewal instructions\n• Payment options\n• Member benefits reminder`);
}

function sendPaymentReminder(email) {
  alert(`💰 Sending payment reminder to ${email}\n\nIncludes:\n• Outstanding balance\n• Payment instructions\n• Membership benefits\n• Contact information for questions`);
}

function approveMembership(memberId) {
  if (confirm(`✅ Approve membership for ${memberId}?\n\nThis will:\n• Activate their membership\n• Send welcome email\n• Add to mailing lists\n• Grant member benefits`)) {
    alert('Membership approved successfully!');
  }
}

// Bulk actions
function sendBulkEmail(type) {
  const types = {
    welcome: 'Welcome emails to new members',
    renewal: 'Renewal reminders to expiring members',
    event: 'Event invitations to all active members'
  };
  
  alert(`📧 ${types[type]}\n\nThis would:\n• Generate personalized emails\n• Send to appropriate member segments\n• Track open/click rates\n• Log communication history`);
}

function exportMemberList() {
  alert('📊 Exporting member list...\n\nGenerating CSV with:\n• All member information\n• Contact details\n• Membership status\n• Payment history');
}

function generateLabels() {
  alert('🏷️ Generating mailing labels...\n\nCreating printable labels for:\n• Active members only\n• Formatted for standard labels\n• Sorted by ZIP code\n• Ready for bulk mailing');
}

function syncMailchimp() {
  alert('📮 Syncing with Mailchimp...\n\nThis would:\n• Update email lists\n• Sync member segments\n• Update preferences\n• Maintain subscription status');
}

// Export functions
function exportCSV() {
  const headers = 'Name,Email,Phone,Class Year,Membership Type,Status,City,Last Payment';
  const csvRows = members.map(member => {
    const status = member.duesStatus === 'current' ? 'Active' : 
                   member.duesStatus === 'pending' ? 'Pending' : 'Expired';
    const lastPayment = member.lastPayment ? new Date(member.lastPayment).toLocaleDateString() : 'Never';
    
    return `"${member.name}","${member.email}","${member.phone}","${member.classYear}","${member.type}","${status}","${member.city}","${lastPayment}"`;
  });
  
  const csvData = [headers, ...csvRows].join('\n');
  
  const blob = new Blob([csvData], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `CVCWVUAA-Members-${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert('📋 Member list exported as CSV!');
}

function exportMailingList() {
  alert('📮 Generating mailing list...\n\nExporting:\n• Active members only\n• Formatted addresses\n• Sorted by region\n• Postal service ready');
}

function exportPhoneList() {
  alert('📞 Generating phone directory...\n\nCreating:\n• Member phone numbers\n• Emergency contacts\n• Board member priority list\n• Call tree structure');
}

function generateMembershipReport() {
  alert('📈 Generating membership report...\n\nIncludes:\n• Growth trends\n• Retention analysis\n• Revenue projections\n• Demographics breakdown');
}

function exportByClass() {
  alert('🎓 Export by class year...\n\nGrouping members by:\n• Graduation decades\n• Reunion planning lists\n• Alumni network mapping\n• Class-specific communications');
}

function exportRenewalList() {
  alert('⏰ Generating renewal report...\n\nTracking:\n• Upcoming renewals\n• Overdue accounts\n• Payment reminder schedule\n• Revenue projections');
}

// Member action functions
function editMember(id) {
  const member = members.find(m => m.id === id);
  if (member) {
    showEditModal(member);
  }
}

function showEditModal(member) {
  // Create edit modal
  const modal = document.createElement('div');
  modal.className = 'edit-modal';
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
      <h2>✏️ Edit Member: ${member.name}</h2>
      
      <div style="display: grid; gap: 1rem; margin: 1.5rem 0;">
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Name:</label>
          <input type="text" id="editName" value="${member.name}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email:</label>
          <input type="email" id="editEmail" value="${member.email}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Phone:</label>
          <input type="tel" id="editPhone" value="${member.phone}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Street Address:</label>
          <input type="text" id="editStreetAddress" value="${member.streetAddress || ''}" placeholder="123 Main St" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">City:</label>
            <input type="text" id="editCity" value="${member.city || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">State:</label>
            <input type="text" id="editState" value="${member.state || 'VA'}" maxlength="2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ZIP:</label>
            <input type="text" id="editZip" value="${member.zip || ''}" placeholder="12345" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Membership Type:</label>
            <select id="editType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="individual" ${member.type === 'individual' ? 'selected' : ''}>Individual</option>
              <option value="family" ${member.type === 'family' ? 'selected' : ''}>Family</option>
              <option value="student" ${member.type === 'student' ? 'selected' : ''}>Student</option>
              <option value="lifetime" ${member.type === 'lifetime' ? 'selected' : ''}>Lifetime</option>
            </select>
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Dues Status:</label>
            <select id="editDuesStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="current" ${member.duesStatus === 'current' ? 'selected' : ''}>Current</option>
              <option value="overdue" ${member.duesStatus === 'overdue' ? 'selected' : ''}>Overdue</option>
              <option value="pending" ${member.duesStatus === 'pending' ? 'selected' : ''}>Pending</option>
            </select>
          </div>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Class Year:</label>
          <input type="text" id="editClassYear" value="${member.classYear || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Last Payment Date:</label>
          <input type="date" id="editLastPayment" value="${member.lastPayment || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
      
      <div style="text-align: right; margin-top: 1.5rem;">
        <button onclick="closeEditModal()" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">Cancel</button>
        <button onclick="saveMemberEdits(${member.id})" style="background: var(--wvu-blue, #002855); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Save Changes</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function saveMemberEdits(memberId) {
  const member = members.find(m => m.id === memberId);
  if (!member) return;
  
  // Get updated values from form
  member.name = document.getElementById('editName').value;
  member.email = document.getElementById('editEmail').value;
  member.phone = document.getElementById('editPhone').value;
  member.type = document.getElementById('editType').value;
  member.duesStatus = document.getElementById('editDuesStatus').value;
  member.classYear = document.getElementById('editClassYear').value;
  member.streetAddress = document.getElementById('editStreetAddress').value;
  member.city = document.getElementById('editCity').value;
  member.state = document.getElementById('editState').value;
  member.zip = document.getElementById('editZip').value;
  member.lastPayment = document.getElementById('editLastPayment').value;
  
  // Update full address
  member.fullAddress = [member.streetAddress, member.city, member.state, member.zip]
    .filter(part => part && part.trim())
    .join(', ');
  
  // Update status for consistency
  member.status = member.duesStatus;
  
  // Save to localStorage so it syncs with advanced member manager
  localStorage.setItem('cvcwvuaa-members', JSON.stringify(members));
  
  // Refresh the display
  renderMemberCards();
  updateMemberStats();
  
  // Close modal
  closeEditModal();
  
  alert(`✅ Successfully updated ${member.name}!`);
}

function closeEditModal() {
  const modals = document.querySelectorAll('.edit-modal');
  modals.forEach(modal => modal.remove());
}

function emailMember(email) {
  window.open(`mailto:${email}?subject=CVCWVUAA Message&body=Hello,\n\nGreetings from the Central Virginia Chapter WVU Alumni Association!\n\nLet's Go Mountaineers!`);
}

function deleteMember(id) {
  const member = members.find(m => m.id === id);
  if (member && confirm(`Delete member "${member.name}"?\n\nThis member will be removed and won't be re-added from future CSV imports.`)) {
    // Add to deleted members list (so they don't come back from CSV)
    const deletedMembers = JSON.parse(localStorage.getItem('cvcwvuaa-deleted-members') || '[]');
    deletedMembers.push({
      name: member.name,
      email: member.email,
      deletedDate: new Date().toISOString(),
      deletedBy: 'admin'
    });
    localStorage.setItem('cvcwvuaa-deleted-members', JSON.stringify(deletedMembers));
    
    // Remove from current members
    members = members.filter(m => m.id !== id);
    
    // Save updated members list
    localStorage.setItem('cvcwvuaa-members', JSON.stringify(members));
    
    renderMemberCards();
    updateMemberStats();
    alert(`🗑️ Deleted member: ${member.name}\n\nThey won't be re-added from future CSV imports.`);
  }
}

function openAddMemberModal() {
  showAddModal();
}

function showAddModal() {
  // Create add modal
  const modal = document.createElement('div');
  modal.className = 'edit-modal';
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
      <h2>➕ Add New Member</h2>
      
      <div style="display: grid; gap: 1rem; margin: 1.5rem 0;">
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Name: *</label>
          <input type="text" id="addName" placeholder="e.g. John Smith or John & Jane Smith" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email: *</label>
          <input type="email" id="addEmail" placeholder="member@email.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Phone:</label>
          <input type="tel" id="addPhone" placeholder="(555) 123-4567" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Street Address:</label>
          <input type="text" id="addStreetAddress" placeholder="123 Main St" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">City:</label>
            <input type="text" id="addCity" placeholder="e.g. Richmond" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">State:</label>
            <input type="text" id="addState" value="VA" maxlength="2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ZIP:</label>
            <input type="text" id="addZip" placeholder="12345" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Membership Type:</label>
            <select id="addType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="individual">Individual</option>
              <option value="family">Family</option>
              <option value="student">Student</option>
              <option value="lifetime">Lifetime</option>
            </select>
          </div>
          
          <div>
            <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Dues Status:</label>
            <select id="addDuesStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="pending">Pending</option>
              <option value="current">Current</option>
              <option value="overdue">Overdue</option>
            </select>
          </div>
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Class Year:</label>
          <input type="text" id="addClassYear" placeholder="e.g. 2010" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div>
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Last Payment Date:</label>
          <input type="date" id="addLastPayment" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
      
      <div style="text-align: right; margin-top: 1.5rem;">
        <button onclick="closeEditModal()" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">Cancel</button>
        <button onclick="saveNewMember()" style="background: var(--wvu-blue, #002855); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">Add Member</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function saveNewMember() {
  // Get values from form
  const name = document.getElementById('addName').value.trim();
  const email = document.getElementById('addEmail').value.trim();
  
  // Validate required fields
  if (!name || !email) {
    alert('❌ Please fill in at least Name and Email fields.');
    return;
  }
  
  // Get address fields
  const streetAddress = document.getElementById('addStreetAddress').value.trim();
  const city = document.getElementById('addCity').value.trim() || 'Virginia';
  const state = document.getElementById('addState').value.trim() || 'VA';
  const zip = document.getElementById('addZip').value.trim();
  
  // Build full address
  const fullAddress = [streetAddress, city, state, zip].filter(part => part).join(', ');
  
  // Create new member
  const newId = Math.max(...members.map(m => m.id), 0) + 1;
  const newMember = {
    id: newId,
    name: name,
    email: email,
    phone: document.getElementById('addPhone').value.trim(),
    type: document.getElementById('addType').value,
    duesStatus: document.getElementById('addDuesStatus').value,
    classYear: document.getElementById('addClassYear').value.trim() || 'Alumni',
    streetAddress: streetAddress,
    city: city,
    state: state,
    zip: zip,
    fullAddress: fullAddress,
    lastPayment: document.getElementById('addLastPayment').value || null,
    year: parseInt(document.getElementById('addClassYear').value) || new Date().getFullYear()
  };
  
  // Add status for consistency
  newMember.status = newMember.duesStatus;
  
  // Add to members array
  members.push(newMember);
  
  // Save to localStorage so it syncs with advanced member manager
  localStorage.setItem('cvcwvuaa-members', JSON.stringify(members));
  
  // Refresh the display
  renderMemberCards();
  updateMemberStats();
  
  // Close modal
  closeEditModal();
  
  alert(`✅ Successfully added new member: ${newMember.name}!`);
}

function importCSVToDirectory() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.csv';
  input.onchange = function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const csvText = e.target.result;
        parseCSVForDirectory(csvText);
      };
      reader.readAsText(file);
    }
  };
  input.click();
}

function smartMergeMembers(csvMembers) {
  // Get deleted members list (so they don't come back)
  const deletedMembers = JSON.parse(localStorage.getItem('cvcwvuaa-deleted-members') || '[]');
  
  let added = 0;
  let updated = 0;
  let preserved = 0;
  let deletedStayDeleted = 0;
  
  csvMembers.forEach(csvMember => {
    // Check if this member was previously deleted (by email or name)
    const wasDeleted = deletedMembers.some(deleted => 
      deleted.email === csvMember.email || 
      deleted.name === csvMember.name
    );
    
    if (wasDeleted) {
      deletedStayDeleted++;
      return; // Skip - this member was intentionally deleted
    }
    
    // Look for existing member by email (most reliable) or name
    const existingIndex = members.findIndex(m => 
      m.email === csvMember.email || 
      (m.name === csvMember.name && csvMember.email)
    );
    
    if (existingIndex === -1) {
      // New member - add them
      const newId = Math.max(...members.map(m => m.id), 0) + 1;
      csvMember.id = newId;
      members.push(csvMember);
      added++;
    } else {
      // Existing member - only update safe fields, preserve admin changes
      const existing = members[existingIndex];
      
      // Only update contact info and basic details - NEVER overwrite:
      // - duesStatus (admin manages this)
      // - lastPayment (admin manages this) 
      // - any custom admin fields
      
      let hasChanges = false;
      
      // Update contact info if CSV has newer/better data
      if (csvMember.phone && csvMember.phone !== existing.phone) {
        existing.phone = csvMember.phone;
        hasChanges = true;
      }
      
      if (csvMember.fullAddress && csvMember.fullAddress !== existing.fullAddress) {
        existing.streetAddress = csvMember.streetAddress;
        existing.city = csvMember.city;
        existing.state = csvMember.state;
        existing.zip = csvMember.zip;
        existing.fullAddress = csvMember.fullAddress;
        hasChanges = true;
      }
      
      if (csvMember.classYear && csvMember.classYear !== existing.classYear) {
        existing.classYear = csvMember.classYear;
        hasChanges = true;
      }
      
      if (hasChanges) {
        updated++;
      } else {
        preserved++;
      }
    }
  });
  
  // Save updated members list
  localStorage.setItem('cvcwvuaa-members', JSON.stringify(members));
  
  return {
    added,
    updated, 
    preserved,
    deletedStayDeleted,
    changes: added + updated
  };
}

function parseCSVForDirectory(csvText) {
  const lines = csvText.split('\n');
  const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
  
  // Debug: Log headers to console (check browser dev tools)
  console.log('CSV Headers found:', headers);
  
  const newMembers = [];
  let id = 1;
  
  for (let i = 1; i < lines.length; i++) {
    if (lines[i].trim()) {
      const values = parseCSVLine(lines[i]);
      const record = {};
      
      headers.forEach((header, index) => {
        record[header] = values[index] ? values[index].trim().replace(/"/g, '') : '';
      });
      
      // Only add if we have a name
      if (record['Last Name'] || record['First Name(s)']) {
        const name = `${record['First Name(s)']} ${record['Last Name']}`.trim();
        const email = record['E-mail Address (Primary)'] || '';
        const phone = record['Primary Phone'] || '';
        
        // Determine membership type
        let type = 'individual';
        const membershipType = record['Type of Membership'] || '';
        if (membershipType.toLowerCase().includes('joint') || membershipType.toLowerCase().includes('family')) {
          type = 'family';
        } else if (membershipType.toLowerCase().includes('student')) {
          type = 'student';
        } else if (membershipType.toLowerCase().includes('lifetime')) {
          type = 'lifetime';
        }
        
        // Determine dues status
        let duesStatus = 'overdue';
        const lastPaid = record['Membership Last Paid'] || '';
        if (lastPaid && new Date(lastPaid).getFullYear() === 2025) {
          duesStatus = 'current';
        } else if (record['Dues'] && record['Dues'] !== '0') {
          duesStatus = 'pending';
        }
        
        // Use exact field names from your CSV
        const streetAddress = record['Home Address'] || '';
        const city = record['City'] || '';
        const state = record['State'] || 'VA';
        const zip = record['Zip Code'] || '';
        // Log for debugging
        if (streetAddress || city || zip) {
          console.log(`Address found for ${name}:`, {streetAddress, city, state, zip});
        } else {
          console.log(`No address data found for ${name} in fields:`, Object.keys(record));
        }
        
        const fullAddress = [streetAddress, city, state, zip].filter(part => part).join(', ');
        
        newMembers.push({
          id: id++,
          name: name,
          email: email,
          phone: phone,
          type: type,
          duesStatus: duesStatus,
          lastPayment: lastPaid || null,
          year: new Date(lastPaid).getFullYear() || 2025,
          classYear: record['Class Year'] || "Alumni",
          major: record['Major'] || "Alumni",
          city: city || "Virginia",
          streetAddress: streetAddress,
          state: state,
          zip: zip,
          fullAddress: fullAddress
        });
      }
    }
  }
  
  if (newMembers.length > 0) {
    // Smart merge: preserve existing data, only add/update carefully
    const result = smartMergeMembers(newMembers);
    
    if (result.changes > 0) {
      const message = `Smart CSV Import Results:
      
✅ New members added: ${result.added}
📝 Members updated: ${result.updated} 
🔒 Existing members preserved: ${result.preserved}
🚫 Deleted members stayed deleted: ${result.deletedStayDeleted}

Your manual changes (payments, dues status) have been preserved!`;
      
      alert(message);
      initializeDirectory();
    } else {
      alert('No new members found in CSV. All existing data preserved.');
    }
  } else {
    alert('No valid member records found in CSV file');
  }
}

function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    
    if (char === '"') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      result.push(current);
      current = '';
    } else {
      current += char;
    }
  }
  result.push(current);
  return result;
}

// Initialize directory when page loads
document.addEventListener('DOMContentLoaded', function() {
  initializeDirectory();
});
</script>

</body>
</html>