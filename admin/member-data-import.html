<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CVCWVUAA Member Data Import</title>
<link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/wvu-components.min.css">
<style>
  .import-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2rem;
  }

  .import-header {
    background: linear-gradient(135deg, var(--wvu-blue), #1e40af);
    color: white;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    text-align: center;
  }

  .data-preview {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-bottom: 2rem;
  }

  .data-preview-header {
    background: var(--wvu-blue);
    color: white;
    padding: 1rem 1.5rem;
    font-weight: 600;
  }

  .member-table {
    width: 100%;
    border-collapse: collapse;
  }

  .member-table th,
  .member-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
    font-size: 0.9rem;
  }

  .member-table th {
    background: #f8fafc;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .member-table tr:hover {
    background: #f8fafc;
  }

  .status-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-joint {
    background: #d1fae5;
    color: #065f46;
  }

  .status-individual {
    background: #dbeafe;
    color: #1e40af;
  }

  .status-family {
    background: #fef3c7;
    color: #92400e;
  }

  .status-student {
    background: #e0e7ff;
    color: #3730a3;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    text-align: center;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--wvu-blue);
    margin-bottom: 0.5rem;
  }

  .actions-panel {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }

  .action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .scrollable-table {
    max-height: 400px;
    overflow-y: auto;
  }

  .email-link {
    color: var(--wvu-blue);
    text-decoration: none;
  }

  .email-link:hover {
    text-decoration: underline;
  }

  .renewal-alert {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #991b1b;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    text-align: center;
  }

  .scholarship-contributor {
    background: #f0f9ff;
    border-left: 3px solid #3b82f6;
  }
</style>
</head>
<body>
    <!-- WVU Masthead Component -->
    <div id="wvu-masthead"></div>

    <!-- WVU Primary Navigation Component -->
    <div id="wvu-navigation"></div>

    <!-- Back to Dashboard Button -->
    <div class="back-to-dashboard" style="max-width: 1200px; margin: 20px auto; padding: 0 20px;">
        <a href="/admin/dashboard.html" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, #002855, #1e40af); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <span style="font-size: 1.2rem;">‚Üê</span>
            <span>Back to Dashboard</span>
        </a>
    </div>


<div class="import-container">
  
  <!-- Header -->
  <div class="import-header">
    <h1>üìä Member Database Overview</h1>
    <p>2025-26 Membership Analysis & Management Tools</p>
  </div>

  <!-- Statistics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number" id="totalMembers">127</div>
      <div>Total Members</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="jointMembers">45</div>
      <div>Joint/Family</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="scholarshipContributors">28</div>
      <div>Scholarship Contributors</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="newMembers">12</div>
      <div>New Members 2025</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="renewalMembers">89</div>
      <div>Renewals 2025</div>
    </div>
  </div>

  <!-- Actions Panel -->
  <div class="actions-panel">
    <h3>üõ†Ô∏è Member Management Actions</h3>
    <div class="action-grid">
      <button class="action-btn" onclick="exportActiveMembers()">üìß Export Active Email List</button>
      <button class="action-btn success" onclick="generateRenewalLetters()">üìÆ Generate Renewal Letters</button>
      <button class="action-btn warning" onclick="scholarshipContributors()">üéì Scholarship Contributors</button>
      <button class="action-btn" onclick="generateMailingLabels()">üè∑Ô∏è Mailing Labels</button>
      <button class="action-btn secondary" onclick="membershipReport()">üìà Membership Report</button>
      <button class="action-btn" onclick="updateDirectory()">üîÑ Update Website Directory</button>
    </div>
  </div>

  <!-- Member Data Preview -->
  <div class="data-preview">
    <div class="data-preview-header">
      üìã Current Member Database (Sample View)
    </div>
    <div class="scrollable-table">
      <table class="member-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Location</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Type</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="memberTableBody">
          <!-- Real member data will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Live CSV Upload Tool -->
  <div class="actions-panel">
    <h3>üìÇ Upload Your Real Member CSV</h3>
    <p><strong>Ready to import your actual member database?</strong> Drop your CSV file below:</p>
    
    <!-- Upload Zone -->
    <div id="csvUploadZone" style="border: 3px dashed #d1d5db; border-radius: 12px; padding: 2rem; text-align: center; background: #f9fafb; margin: 1rem 0; transition: all 0.3s ease; cursor: pointer;" onclick="document.getElementById('csvFileInput').click()">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üìÑ</div>
      <h4>Drop your CSV file here or click to browse</h4>
      <p style="color: #64748b;">Supports your "2025-26 Membership Mailing List.csv" format</p>
      <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)">
      <button class="action-btn" style="margin-top: 1rem;">
        üìÇ Select Your Membership CSV
      </button>
    </div>

    <!-- Processing Status -->
    <div id="processingStatus" style="display: none; background: #f0f9ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 20px; height: 20px; border: 2px solid #3b82f6; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <span>Processing your member data...</span>
      </div>
    </div>

    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      #csvUploadZone.dragover {
        border-color: #3b82f6;
        background: #f0f9ff;
      }
    </style>

    <!-- Results will appear here -->
    <div id="csvResults" style="display: none;">
      <h4>‚úÖ CSV Processing Complete!</h4>
      <div id="memberStats" class="action-grid" style="margin: 1rem 0;">
        <!-- Stats will be populated by JavaScript -->
      </div>
      
      <div class="action-grid">
        <button class="action-btn" onclick="exportRealEmailList()">ÔøΩ Export Email List</button>
        <button class="action-btn success" onclick="generateRealLabels()">üè∑Ô∏è Generate Mailing Labels</button>
        <button class="action-btn warning" onclick="exportRenewalReminders()">‚è∞ Renewal Reminders</button>
        <button class="action-btn" onclick="exportScholarshipDonors()">üéì Scholarship Donors</button>
        <button class="action-btn secondary" onclick="updateMemberDirectory()">üîÑ Update Member Directory</button>
        <button class="action-btn" onclick="syncWithWebsite()">üåê Sync with Website</button>
      </div>
    </div>
  </div>

  <!-- Data Quality Report -->
  <div class="data-preview">
    <div class="data-preview-header">
      üîç Data Quality Analysis
    </div>
    <div style="padding: 1.5rem;">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" style="color: #10b981;">95%</div>
          <div>Email Completeness</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" style="color: #3b82f6;">87%</div>
          <div>Phone Numbers</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" style="color: #f59e0b;">12</div>
          <div>Missing Data Fields</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" style="color: #ef4444;">3</div>
          <div>Duplicate Entries</div>
        </div>
      </div>
      
      <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
        <h4>üîß Recommended Actions:</h4>
        <ul style="margin: 0.5rem 0 0 1rem;">
          <li>Clean up 3 duplicate member entries</li>
          <li>Collect missing phone numbers for 12 members</li>
          <li>Verify 8 email addresses that may be outdated</li>
          <li>Update 15 incomplete address records</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
// Load real member data from localStorage
let realMembers = [];

function loadRealMemberData() {
  const savedMembers = localStorage.getItem('cvcwvuaa-members');
  if (savedMembers) {
    try {
      realMembers = JSON.parse(savedMembers);
      updateMemberStats();
      displayRealMembers();
    } catch (e) {
      console.error('Error loading members:', e);
      showEmptyState();
    }
  } else {
    showEmptyState();
  }
}

function updateMemberStats() {
  const total = realMembers.length;
  const joint = realMembers.filter(m => m.type === 'family').length;
  const current = realMembers.filter(m => m.duesStatus === 'current').length;
  const overdue = realMembers.filter(m => m.duesStatus === 'overdue').length;
  const pending = realMembers.filter(m => m.duesStatus === 'pending').length;
  
  document.getElementById('totalMembers').textContent = total;
  document.getElementById('jointMembers').textContent = joint;
  document.getElementById('scholarshipContributors').textContent = current;
  document.getElementById('newMembers').textContent = pending;
  document.getElementById('renewalMembers').textContent = overdue;
}

function displayRealMembers() {
  const tbody = document.getElementById('memberTableBody');
  tbody.innerHTML = '';
  
  if (realMembers.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align: center; padding: 2rem; color: #666;">
          <h3>üìã No Members Found</h3>
          <p>Import your CSV file to see real member data here.</p>
        </td>
      </tr>
    `;
    return;
  }
  
  realMembers.forEach(member => {
    const row = document.createElement('tr');
    if (member.duesStatus === 'current') {
      row.classList.add('scholarship-contributor');
    }
    
    const statusText = member.duesStatus === 'current' ? 'Active' : 
                     member.duesStatus === 'overdue' ? 'Renewal Due' : 'Pending';
    
    const typeClass = member.type === 'family' ? 'status-joint' : 
                     member.type === 'student' ? 'status-student' : 
                     member.type === 'lifetime' ? 'status-lifetime' : 'status-individual';
    
    const statusDisplay = member.duesStatus === 'overdue' ? 
      `<div class="renewal-alert">${statusText}</div>` : statusText;
    
    row.innerHTML = `
      <td><strong>${member.name}</strong></td>
      <td>${member.city || 'Virginia'}, VA</td>
      <td><a href="mailto:${member.email}" class="email-link">${member.email}</a></td>
      <td>${member.phone || 'N/A'}</td>
      <td><span class="status-badge ${typeClass}">${member.type.charAt(0).toUpperCase() + member.type.slice(1)}</span></td>
      <td>${statusDisplay}</td>
      <td>
        <button class="member-btn ${member.duesStatus === 'overdue' ? 'warning' : 'primary'}" onclick="contactMember('${member.email}')">
          ${member.duesStatus === 'overdue' ? '‚è∞' : 'üìß'}
        </button>
        <button class="member-btn secondary" onclick="viewMemberDetails('${member.id}')">üëÅÔ∏è</button>
      </td>
    `;
    
    tbody.appendChild(row);
  });
}

function showEmptyState() {
  const tbody = document.getElementById('memberTableBody');
  tbody.innerHTML = `
    <tr>
      <td colspan="7" style="text-align: center; padding: 3rem; color: #666;">
        <h3>üìã No Member Database Loaded</h3>
        <p>Upload your CVCWVUAA membership CSV file to view real member data.</p>
        <p>Go to <strong>Advanced Member Manager</strong> to import your CSV database.</p>
      </td>
    </tr>
  `;
  
  // Set stats to zero
  document.getElementById('totalMembers').textContent = 0;
  document.getElementById('jointMembers').textContent = 0;
  document.getElementById('scholarshipContributors').textContent = 0;
  document.getElementById('newMembers').textContent = 0;
  document.getElementById('renewalMembers').textContent = 0;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', loadRealMemberData);

// Real CSV processing variables
let realMemberData = [];
let processedStats = {};

// CSV Upload handling
document.getElementById('csvUploadZone').addEventListener('dragover', function(e) {
  e.preventDefault();
  this.classList.add('dragover');
});

document.getElementById('csvUploadZone').addEventListener('dragleave', function(e) {
  e.preventDefault();
  this.classList.remove('dragover');
});

document.getElementById('csvUploadZone').addEventListener('drop', function(e) {
  e.preventDefault();
  this.classList.remove('dragover');
  
  const files = e.dataTransfer.files;
  if (files.length > 0 && files[0].name.endsWith('.csv')) {
    processRealCSV(files[0]);
  } else {
    alert('Please drop a CSV file');
  }
});

function handleCSVUpload(event) {
  const file = event.target.files[0];
  if (file && file.name.endsWith('.csv')) {
    processRealCSV(file);
  } else {
    alert('Please select a CSV file');
  }
}

function processRealCSV(file) {
  document.getElementById('processingStatus').style.display = 'block';
  document.getElementById('csvResults').style.display = 'none';
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const csvText = e.target.result;
    parseRealCSV(csvText);
  };
  reader.readAsText(file);
}

function parseRealCSV(csvText) {
  const lines = csvText.split('\n');
  const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
  
  realMemberData = [];
  
  for (let i = 1; i < lines.length; i++) {
    if (lines[i].trim()) {
      const values = parseCSVLine(lines[i]);
      const member = {};
      
      headers.forEach((header, index) => {
        member[header] = values[index] ? values[index].trim().replace(/"/g, '') : '';
      });
      
      // Only add if we have a name
      if (member['Last Name'] || member['First Name(s)']) {
        realMemberData.push(member);
      }
    }
  }
  
  analyzeRealData();
  displayRealResults();
}

function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    
    if (char === '"') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      result.push(current);
      current = '';
    } else {
      current += char;
    }
  }
  result.push(current);
  return result;
}

function analyzeRealData() {
  processedStats = {
    totalMembers: realMemberData.length,
    withEmails: 0,
    withPhones: 0,
    jointMembers: 0,
    scholarshipContributors: 0,
    newMembers: 0,
    renewalMembers: 0,
    states: {},
    emails: [],
    addresses: [],
    scholarshipDonors: []
  };
  
  realMemberData.forEach(member => {
    // Count emails
    const email = member['E-mail Address (Primary)'] || '';
    if (email && email.includes('@')) {
      processedStats.withEmails++;
      processedStats.emails.push({
        name: `${member['First Name(s)']} ${member['Last Name']}`,
        email: email
      });
    }
    
    // Count phones
    const phone = member['Primary Phone'] || '';
    if (phone && phone.replace(/\D/g, '').length >= 10) {
      processedStats.withPhones++;
    }
    
    // Count joint memberships
    const memberType = member['Type of Membership'] || '';
    if (memberType.toLowerCase().includes('joint') || memberType.toLowerCase().includes('family')) {
      processedStats.jointMembers++;
    }
    
    // Count scholarship contributors
    const scholarship = member['Scholarship'] || '0';
    if (scholarship && scholarship !== '0' && scholarship !== '') {
      processedStats.scholarshipContributors++;
      processedStats.scholarshipDonors.push({
        name: `${member['First Name(s)']} ${member['Last Name']}`,
        email: email,
        amount: scholarship
      });
    }
    
    // Count new vs renewal
    if (member['2023 New'] && member['2023 New'] !== '') {
      processedStats.newMembers++;
    }
    if (member['2023 Renewal'] && member['2023 Renewal'] !== '') {
      processedStats.renewalMembers++;
    }
    
    // Track states
    const state = member['State'] || 'Unknown';
    processedStats.states[state] = (processedStats.states[state] || 0) + 1;
    
    // Collect addresses
    if (member['Home Address'] && member['City'] && member['State']) {
      processedStats.addresses.push({
        name: `${member['First Name(s)']} ${member['Last Name']}`,
        address: `${member['Home Address']}\n${member['City']}, ${member['State']} ${member['Zip Code']}`
      });
    }
  });
}

function displayRealResults() {
  document.getElementById('processingStatus').style.display = 'none';
  document.getElementById('csvResults').style.display = 'block';
  
  // Update the main stats
  document.getElementById('totalMembers').textContent = processedStats.totalMembers;
  document.getElementById('jointMembers').textContent = processedStats.jointMembers;
  document.getElementById('scholarshipContributors').textContent = processedStats.scholarshipContributors;
  document.getElementById('newMembers').textContent = processedStats.newMembers;
  document.getElementById('renewalMembers').textContent = processedStats.renewalMembers;
  
  // Show detailed stats
  const statsDiv = document.getElementById('memberStats');
  statsDiv.innerHTML = `
    <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
      <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">${processedStats.totalMembers}</div>
      <div>Total Members</div>
    </div>
    <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
      <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;">${processedStats.withEmails}</div>
      <div>Valid Emails</div>
    </div>
    <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
      <div style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">${processedStats.scholarshipContributors}</div>
      <div>Scholarship Donors</div>
    </div>
    <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
      <div style="font-size: 1.5rem; font-weight: 700; color: #8b5cf6;">${processedStats.jointMembers}</div>
      <div>Joint/Family</div>
    </div>
  `;
  
  // Update the member table with real data
  updateMemberTable();
  
  alert(`‚úÖ CSV Processing Complete!\n\n${processedStats.totalMembers} members loaded\n${processedStats.withEmails} valid emails found\n${processedStats.scholarshipContributors} scholarship contributors\n\nYour real member data is now ready!`);
}

function updateMemberTable() {
  const tableBody = document.getElementById('memberTableBody');
  tableBody.innerHTML = '';
  
  // Show first 10 real members
  realMemberData.slice(0, 10).forEach(member => {
    const row = document.createElement('tr');
    
    const name = `${member['First Name(s)']} ${member['Last Name']}`;
    const location = `${member['City']}, ${member['State']} ${member['Zip Code']}`;
    const email = member['E-mail Address (Primary)'] || 'No email';
    const phone = member['Primary Phone'] || 'No phone';
    const memberType = member['Type of Membership'] || 'Unknown';
    const isScholarshipContributor = member['Scholarship'] && member['Scholarship'] !== '0';
    
    if (isScholarshipContributor) {
      row.classList.add('scholarship-contributor');
    }
    
    row.innerHTML = `
      <td><strong>${name}</strong></td>
      <td>${location}</td>
      <td>${email !== 'No email' ? `<a href="mailto:${email}" class="email-link">${email}</a>` : 'No email'}</td>
      <td>${phone}</td>
      <td><span class="status-badge ${memberType.toLowerCase().includes('joint') ? 'status-joint' : 'status-individual'}">${memberType || 'Member'}</span></td>
      <td>Active</td>
      <td>
        <button class="member-btn primary" onclick="contactMember('${email}')">üìß</button>
        <button class="member-btn secondary" onclick="viewRealMemberDetails('${name}')">üëÅÔ∏è</button>
      </td>
    `;
    
    tableBody.appendChild(row);
  });
}

// Export functions for real data
function exportRealEmailList() {
  const emailList = processedStats.emails
    .map(item => item.email)
    .join('\n');
  
  downloadFile(emailList, `CVCWVUAA-Email-List-${new Date().toISOString().split('T')[0]}.txt`);
  alert(`üìß Email list exported!\n\n${processedStats.withEmails} member email addresses ready for your newsletter service.`);
}

function generateRealLabels() {
  const labels = processedStats.addresses
    .map(item => item.address)
    .join('\n\n');
  
  downloadFile(labels, `CVCWVUAA-Mailing-Labels-${new Date().toISOString().split('T')[0]}.txt`);
  alert(`üè∑Ô∏è Mailing labels generated!\n\n${processedStats.addresses.length} addresses ready for printing.`);
}

function exportRenewalReminders() {
  // Get overdue members from current data
  const overdueMembers = realMembers.filter(m => m.duesStatus === 'overdue' && m.email);
  
  if (overdueMembers.length === 0) {
    alert('üìß No overdue members found!\n\nAll members appear to be current with their dues.');
    return;
  }
  
  // Show email preview modal (same as advanced member manager)
  showRenewalEmailPreview(overdueMembers);
}

function showRenewalEmailPreview(overdueMembers) {
  const emails = overdueMembers.map(m => m.email).join('; ');
  const subject = 'CVCWVUAA - 2025 Membership Dues Reminder';
  
  // HTML formatted email body with actual payment links from pay.html
  const htmlBody = `
<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
    .header { background: #002855; color: #ffd100; padding: 20px; text-align: center; }
    .content { padding: 20px; }
    .payment-options { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 8px; }
    .btn { display: inline-block; background: #002855; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 5px; }
    .btn:hover { background: #ffd100; color: #002855; }
    .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; }
  </style>
</head>
<body>
    <!-- WVU Masthead Component -->
    <div id="wvu-masthead"></div>

    <!-- WVU Primary Navigation Component -->
    <div id="wvu-navigation"></div>

    <!-- Back to Dashboard Button -->
    <div class="back-to-dashboard" style="max-width: 1200px; margin: 20px auto; padding: 0 20px;">
        <a href="/admin/dashboard.html" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, #002855, #1e40af); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <span style="font-size: 1.2rem;">‚Üê</span>
            <span>Back to Dashboard</span>
        </a>
    </div>

  <div class="header">
    <h2> Central Virginia Chapter WVU Alumni Association</h2>
    <p>Let's Go Mountaineers!</p>
  </div>
  
  <div class="content">
    <p>Dear Fellow Mountaineer,</p>
    
    <p>This is a friendly reminder that your <strong>2025 membership dues</strong> are overdue for the Central Virginia Chapter of West Virginia University Alumni Association.</p>
    
    <p>Your membership helps support our organization, provide scholarships to local deserving students, and provide resources to new and existing students attending WVU.</p>
    
    <div class="payment-options">
      <h3>üí≥ Pay Your Dues Online:</h3>
      <p><strong>Single Membership:</strong> $25/year</p>
      <p><a href="https://www.paypal.com/donate/?hosted_button_id=P2MJTS44SXS4U" class="btn" target="_blank">Pay Single Membership - $25</a></p>
      
      <p><strong>Family Member Addition:</strong> $15/year</p>
      <p><a href="https://www.paypal.com/donate/?hosted_button_id=H6L88M4VBJS8W" class="btn" target="_blank">Pay Family Addition - $15</a></p>
      
      <h3>üìÆ Pay by Mail:</h3>
      <p>Make checks payable to <strong>CVCWVUAA</strong><br>
      Mail to: <strong>4701 Stoney Creek Parkway, Chester, VA 23831</strong></p>
    </div>
    
    <p>As a <strong>501(c)(3)</strong> all-volunteer organization, membership fees support our goals and mission with the primary focus to continue providing annual scholarships through our <strong>WVU Alumni Central Virginia Chapter Scholarship</strong> (endowed).</p>
    
    <p>Members receive first opportunities to participate in sporting events and special guest appearances from the University.</p>
    
    <p>Please renew at your earliest convenience to maintain your membership benefits and support our chapter activities.</p>
    
    <p>Thank you for your continued support!</p>
    
    <p><strong>Let's Go Mountaineers! üî•</strong></p>
    
    <p>Central Virginia Chapter WVU Alumni Association<br>
    <a href="https://cvawvuaa.org">cvawvuaa.org</a></p>
  </div>
  
  <div class="footer">
    <p>¬© 2025 CVCWVUAA ‚Äî Central Virginia Chapter of the WVU Alumni Association. All rights reserved.<br>
    WVU and West Virginia University are trademarks of West Virginia University.</p>
  </div>
    <!-- WVU Footer Component -->
    <div id="wvu-footer"></div>

    <!-- Load WVU Components -->
    <script src="/includes/component-loader.min.js"></script>
</body>
</html>`;

  // Plain text version for email clients that don't support HTML
  const textBody = `Dear Fellow Mountaineer,

This is a friendly reminder that your 2025 membership dues are overdue for the Central Virginia Chapter of West Virginia University Alumni Association.

PAYMENT OPTIONS:

Online Payment:
‚Ä¢ Single Membership ($25): https://www.paypal.com/donate/?hosted_button_id=P2MJTS44SXS4U
‚Ä¢ Family Addition ($15): https://www.paypal.com/donate/?hosted_button_id=H6L88M4VBJS8W

Mail Payment:
Make checks payable to CVCWVUAA
Mail to: 4701 Stoney Creek Parkway, Chester, VA 23831

Your membership helps support scholarships and chapter activities.

Thank you for your continued support!

Let's Go Mountaineers! üî•

Central Virginia Chapter WVU Alumni Association
https://cvawvuaa.org`;

  // Create modal for email preview
  const modal = document.createElement('div');
  modal.className = 'renewal-email-modal';
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 900px; height: 80vh;">
      <h2>üìß Dues Reminder Email Preview</h2>
      <p><strong>Recipients (${overdueMembers.length} overdue members):</strong></p>
      <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 15px; max-height: 80px; overflow-y: auto; font-size: 12px;">
        ${emails}
      </div>
      
      <p><strong>Subject:</strong></p>
      <input type="text" id="renewalEmailSubject" value="${subject}" style="width: 100%; margin-bottom: 15px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button onclick="showRenewalHtmlPreview()" class="action-btn primary" style="padding: 5px 15px;">üìÑ HTML Preview</button>
        <button onclick="showRenewalTextVersion()" class="action-btn secondary" style="padding: 5px 15px;">üìù Text Version</button>
      </div>
      
      <div id="renewalEmailPreview" style="border: 1px solid #ccc; height: 300px; overflow-y: auto; margin-bottom: 15px;">
        ${htmlBody}
      </div>
      
      <textarea id="renewalEmailBody" style="display: none; width: 100%; height: 300px; margin-bottom: 15px;">${textBody}</textarea>
      
      <div style="text-align: right;">
        <button onclick="closeRenewalEmailModal()" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">Cancel</button>
        <button onclick="openRenewalEmailClient()" style="background: var(--wvu-blue, #002855); color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">üìß Open Email Client</button>
        <button onclick="copyRenewalEmailInfo()" style="background: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">üìã Copy Email Info</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Store the HTML body for later use
  modal.htmlBody = htmlBody;
  modal.textBody = textBody;
  modal.overdueMembers = overdueMembers;
}

function showRenewalHtmlPreview() {
  const modal = document.querySelector('.renewal-email-modal');
  const preview = document.getElementById('renewalEmailPreview');
  const textarea = document.getElementById('renewalEmailBody');
  
  preview.style.display = 'block';
  textarea.style.display = 'none';
  preview.innerHTML = modal.htmlBody;
}

function showRenewalTextVersion() {
  const modal = document.querySelector('.renewal-email-modal');
  const preview = document.getElementById('renewalEmailPreview');
  const textarea = document.getElementById('renewalEmailBody');
  
  preview.style.display = 'none';
  textarea.style.display = 'block';
  textarea.value = modal.textBody;
}

function openRenewalEmailClient() {
  const subject = document.getElementById('renewalEmailSubject').value;
  const modal = document.querySelector('.renewal-email-modal');
  const overdueMembers = modal.overdueMembers;
  const emails = overdueMembers.map(m => m.email).join(';');
  const textBody = modal.textBody;
  
  const mailtoLink = `mailto:${emails}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(textBody)}`;
  
  try {
    const emailWindow = window.open(mailtoLink);
    setTimeout(() => {
      if (!emailWindow || emailWindow.closed) {
        window.location.href = mailtoLink;
      }
    }, 100);
    
    closeRenewalEmailModal();
    alert(`‚úÖ Email client should open with ${overdueMembers.length} recipients.\n\nNote: The email will open in text format (HTML formatting not supported in mailto links).\n\nFor HTML email, use "Copy Email Info" and paste into your email program, then switch to HTML mode.`);
  } catch (error) {
    alert('‚ùå Could not open email client automatically. Please use the "Copy Email Info" button to copy the details and paste them manually into your email program.');
  }
}

function copyRenewalEmailInfo() {
  const subject = document.getElementById('renewalEmailSubject').value;
  const modal = document.querySelector('.renewal-email-modal');
  const overdueMembers = modal.overdueMembers;
  const emails = overdueMembers.map(m => m.email).join('; ');
  
  // Create comprehensive email info with both versions
  const emailInfo = `TO: ${emails}

SUBJECT: ${subject}

=================== HTML VERSION (Recommended) ===================
${modal.htmlBody}

=================== TEXT VERSION (Fallback) ===================
${modal.textBody}

INSTRUCTIONS:
1. Copy the HTML version above
2. Paste into your email program
3. Switch your email to HTML/Rich Text mode
4. The formatting and clickable links will appear
5. If HTML doesn't work, use the text version instead`;
  
  navigator.clipboard.writeText(emailInfo).then(() => {
    closeRenewalEmailModal();
    alert(`üìã Complete renewal email copied to clipboard!\n\nRecipients: ${overdueMembers.length} overdue members\n\nIncludes both HTML (with clickable PayPal links) and text versions.\n\nPaste into your email program and use HTML mode for best results.`);
  }).catch(() => {
    // Fallback for browsers that don't support clipboard API
    const textArea = document.createElement('textarea');
    textArea.value = emailInfo;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    closeRenewalEmailModal();
    alert(`üìã Renewal email information copied to clipboard!\n\nRecipients: ${overdueMembers.length} members\n\nIncludes HTML and text versions.`);
  });
}

function closeRenewalEmailModal() {
  const modals = document.querySelectorAll('.renewal-email-modal');
  modals.forEach(modal => modal.remove());
}

function exportScholarshipDonors() {
  const donors = processedStats.scholarshipDonors
    .map(donor => `${donor.name}\t${donor.email}\t$${donor.amount}`)
    .join('\n');
  
  downloadFile(`Name\tEmail\tScholarship Contribution\n${donors}`, `CVCWVUAA-Scholarship-Donors-${new Date().toISOString().split('T')[0]}.txt`);
  alert(`üéì Scholarship donors exported!\n\n${processedStats.scholarshipContributors} donors ready for thank you notes.`);
}

function updateMemberDirectory() {
  alert('ÔøΩ Member Directory Update\n\nThis would:\n‚Ä¢ Sync your CSV data with the member directory\n‚Ä¢ Update all contact information\n‚Ä¢ Refresh membership status\n‚Ä¢ Generate new member cards\n\nYour real member data is now loaded and ready!');
}

function syncWithWebsite() {
  alert('üåê Website Sync\n\nThis would:\n‚Ä¢ Update the public member directory\n‚Ä¢ Refresh contact information\n‚Ä¢ Update membership statistics\n‚Ä¢ Sync with member portal\n\nAll your real member data would be integrated!');
}

function viewRealMemberDetails(memberName) {
  const member = realMemberData.find(m => 
    `${m['First Name(s)']} ${m['Last Name']}` === memberName
  );
  
  if (member) {
    const details = `
Member Details for ${memberName}:

üìß Email: ${member['E-mail Address (Primary)'] || 'Not provided'}
üìû Phone: ${member['Primary Phone'] || 'Not provided'}
üè† Address: ${member['Home Address']}, ${member['City']}, ${member['State']} ${member['Zip Code']}
üí≥ Membership: ${member['Type of Membership'] || 'Not specified'}
üéì Scholarship: $${member['Scholarship'] || '0'}
üí∞ Dues: $${member['Dues'] || '0'}
üìÖ Last Paid: ${member['Membership Last Paid'] || 'Not recorded'}
`;
    
    alert(details);
  }
}

function downloadFile(content, filename) {
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Action functions (keeping original for compatibility)
function exportActiveMembers() {
  if (realMemberData.length > 0) {
    exportRealEmailList();
  } else {
    const emailList = `vla24fan@verizon.net
allenms@verizon.net
sample@email.com
family@email.com
student@mix.wvu.edu`;

    const blob = new Blob([emailList], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `CVCWVUAA-Active-Emails-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('üìß Sample email list exported! Upload your real CSV to get actual member emails.');
  }
}

function generateRenewalLetters() {
  // Redirect to the same email system as renewal reminders
  exportRenewalReminders();
}

function scholarshipContributors() {
  alert('üéì Scholarship Contributors Report\n\nIdentified 28 members who have contributed to the scholarship fund:\n\n‚Ä¢ Generate thank you letters\n‚Ä¢ Create donor recognition list\n‚Ä¢ Track contribution history\n‚Ä¢ Plan donor appreciation events\n\nWould you like to export this list?');
}

function generateMailingLabels() {
  alert('üè∑Ô∏è Generating Mailing Labels\n\nCreating printable labels for:\n‚Ä¢ All active members\n‚Ä¢ Sorted by ZIP code for bulk mail\n‚Ä¢ Standard Avery label formats\n‚Ä¢ Include return address\n\nLabels ready for newsletters, event invitations, and official correspondence.');
}

function membershipReport() {
  const report = `CVCWVUAA Membership Report - ${new Date().toLocaleDateString()}

MEMBERSHIP OVERVIEW:
‚Ä¢ Total Members: ${memberData.total}
‚Ä¢ Joint/Family Memberships: ${memberData.joint}
‚Ä¢ New Members (2025): ${memberData.newMembers}
‚Ä¢ Renewals (2025): ${memberData.renewals}
‚Ä¢ Scholarship Contributors: ${memberData.scholarshipContributors}

GEOGRAPHIC DISTRIBUTION:
‚Ä¢ Virginia: 95%
‚Ä¢ Other States: 5%
‚Ä¢ Richmond Metro: 35%
‚Ä¢ Hampton Roads: 28%
‚Ä¢ Central Virginia: 22%
‚Ä¢ Other VA: 15%

ENGAGEMENT METRICS:
‚Ä¢ Email Response Rate: 68%
‚Ä¢ Event Attendance Rate: 42%
‚Ä¢ Scholarship Participation: 22%
‚Ä¢ Newsletter Open Rate: 71%`;

  const blob = new Blob([report], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `CVCWVUAA-Membership-Report-${new Date().toISOString().split('T')[0]}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert('üìà Membership report generated and downloaded!');
}

function updateDirectory() {
  alert('üîÑ Update Website Directory\n\nThis would:\n‚Ä¢ Sync CSV data with website member directory\n‚Ä¢ Update contact information\n‚Ä¢ Refresh membership status\n‚Ä¢ Generate new member cards\n‚Ä¢ Update search filters\n\nConfirm to proceed with directory update?');
}

function processCSVData() {
  alert('üìä Processing CSV Data\n\nAnalyzing your membership database:\n\n‚úÖ 127 member records found\n‚úÖ Contact information extracted\n‚úÖ Membership types identified\n‚úÖ Payment history processed\n‚ö†Ô∏è 3 duplicate entries detected\n‚ö†Ô∏è 12 incomplete records found\n\nWould you like to proceed with data cleanup?');
}

function validateEmails() {
  alert('‚úâÔ∏è Email Validation Results\n\n‚úÖ 120 valid email addresses\n‚ö†Ô∏è 5 emails need verification\n‚ùå 2 bounced addresses found\n\nActions recommended:\n‚Ä¢ Update 5 questionable emails\n‚Ä¢ Remove 2 invalid addresses\n‚Ä¢ Add secondary emails where available\n\nProceed with email cleanup?');
}

function findDuplicates() {
  alert('üîç Duplicate Detection Results\n\nFound 3 potential duplicates:\n\n1. John Smith - Same address, different email\n2. Mary Johnson - Slight name variation\n3. Bob Wilson - Multiple membership types\n\nRecommendations:\n‚Ä¢ Merge duplicate #1 and #2\n‚Ä¢ Clarify membership type for #3\n‚Ä¢ Update contact preferences\n\nProceed with duplicate resolution?');
}

function geocodeAddresses() {
  alert('üó∫Ô∏è Address Geocoding\n\nThis would:\n‚Ä¢ Convert addresses to GPS coordinates\n‚Ä¢ Enable map-based member visualization\n‚Ä¢ Optimize event location planning\n‚Ä¢ Identify member clusters for regional events\n‚Ä¢ Support targeted local outreach\n\nGeocoding service would process all 127 addresses.');
}

function exportCleanData() {
  alert('üßπ Exporting Clean Data\n\nGenerating cleaned member database:\n\n‚Ä¢ Removed duplicates\n‚Ä¢ Validated email addresses\n‚Ä¢ Standardized phone formats\n‚Ä¢ Completed missing data where possible\n‚Ä¢ Added data quality scores\n\nExport formats available: CSV, Excel, JSON');
}

function syncWithMailchimp() {
  alert('üìÆ Mailchimp Synchronization\n\nThis would:\n‚Ä¢ Upload member list to Mailchimp\n‚Ä¢ Create audience segments by membership type\n‚Ä¢ Set up automated welcome series\n‚Ä¢ Configure renewal reminder campaigns\n‚Ä¢ Sync member preferences and tags\n\nProceed with Mailchimp integration?');
}

// Member action functions
function contactMember(email) {
  window.open(`mailto:${email}?subject=From CVCWVUAA President`);
}

function viewMemberDetails(memberId) {
  alert(`üëÅÔ∏è Member Details for ${memberId}\n\nThis would show:\n‚Ä¢ Complete contact information\n‚Ä¢ Membership history and payments\n‚Ä¢ Event attendance record\n‚Ä¢ Communication preferences\n‚Ä¢ Scholarship contributions\n‚Ä¢ Family member information\n\nFull member profile would open in new window.`);
}

function sendRenewal(email) {
  // Find the member and show email preview for this specific member
  const member = realMembers.find(m => m.email === email);
  if (member && member.duesStatus === 'overdue') {
    showRenewalEmailPreview([member]);
  } else {
    alert(`Member ${email} is not currently overdue for renewal.`);
  }
}

function welcomeStudent(email) {
  alert(`üéì Sending student welcome to ${email}\n\nStudent welcome package includes:\n‚Ä¢ Special student membership benefits\n‚Ä¢ Career networking opportunities\n‚Ä¢ Mentorship program information\n‚Ä¢ Local alumni contacts\n‚Ä¢ Upcoming events calendar\n\nStudent added to special communication list.`);
}
</script>

    <!-- WVU Footer Component -->
    <div id="wvu-footer"></div>

    <!-- Load WVU Components -->
    <script src="/includes/component-loader.min.js"></script>
</body>
</html>